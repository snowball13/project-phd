\documentclass[11pt, oneside]{article}   	% use "amsart" instead of "article" for AMSLaTeX format
\usepackage{geometry}                		% See geometry.pdf to learn the layout options. There are lots.
\geometry{letterpaper}                   		% ... or a4paper or a5paper or ... 
%\geometry{landscape}                		% Activate for rotated page geometry
\usepackage[parfill]{parskip}    		% Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}				% Use pdf, png, jpg, or epsÂ§ with pdflatex; use eps in DVI mode
								% TeX will automatically convert eps --> pdf in pdflatex		
\usepackage{caption}
\usepackage{subcaption}
\usepackage{float}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{bm}
\usepackage{bbm}
\usepackage{mleftright}
\usepackage{todonotes}

\newcommand{\sotodo}{\todo[color=green]}
\newcommand{\sotodoinline}{\todo[color=green,inline=true]}
\newcommand{\bstodo}{\todo[color=pink]}
\newcommand{\bstodoinline}{\todo[color=pink,inline=true]}


%SetFonts

%SetFonts

\usepackage{natbib}
\usepackage{url}
%\bibliographystyle{elsarticle-harv}
\bibliographystyle{plain}

\newcommand{\half}{\frac{1}{2}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\No}{\mathbb{N}_0}
\newcommand{\Ylm}{Y^m_l}
\newcommand{\Ylmfull}{Y^m_l(\theta,\varphi)}
\newcommand{\Plm}{P^m_l}
\newcommand{\costheta}{\cos\theta}
\newcommand{\sintheta}{\sin\theta}
\newcommand{\cosphi}{\cos\varphi}
\newcommand{\sinphi}{\sin\varphi}
\newcommand{\eimphi}{e^{im\varphi}}
\newcommand{\alphalm}{\alpha^m_l}
\newcommand{\clm}{c^m_l}
\newcommand{\ctilde}{\tilde{c}^m_l}
\newcommand{\ctildemod}{\tilde{c}^{|m|}_l}
\newcommand{\chat}{\hat{c}^m_l}
\newcommand{\chatmod}{\hat{c}^{|m|}_l}
\newcommand{\ddx}{\frac{\mathrm{d}}{\mathrm{d}x}}
\newcommand{\dmdxm}{\frac{\mathrm{d}^m}{\mathrm{d}x^m}}

\newcommand{\Atilde}{\tilde{A}_{l,m}}
\newcommand{\Btilde}{\tilde{B}_{l,m}}
\newcommand{\Dtilde}{\tilde{D}_{l,m}}
\newcommand{\Etilde}{\tilde{E}_{l,m}}
\newcommand{\Ftilde}{\tilde{F}_{l,m}}
\newcommand{\Gtilde}{\tilde{G}_{l,m}}
\newcommand{\Alm}{A_{l,m}}
\newcommand{\Blm}{B_{l,m}}
\newcommand{\Dlm}{D_{l,m}}
\newcommand{\Elm}{E_{l,m}}
\newcommand{\Flm}{F_{l,m}}
\newcommand{\Glm}{G_{l,m}}

\newcommand{\xione}{\xi^{(1)}_{n, \lambda}}
\newcommand{\xitwo}{\xi^{(2)}_{n, \lambda}}
\newcommand{\xithree}{\xi^{(3)}_{n, \lambda}}
\newcommand{\xifour}{\xi^{(4)}_{n, \lambda}}

\newcommand{\bigP}{\mathbb{P}}
\newcommand{\Pl}{\mathbb{P}_l}
\newcommand{\gradP}{T\mathbb{P}}
\newcommand{\gradPl}{T\mathbb{P}_l}
\newcommand{\gradY}{\nabla Y}
\newcommand{\gradYlm}{\nabla Y^m_l}
\newcommand{\gradpY}{\nabla^\perp Y}
\newcommand{\gradpYlm}{\nabla^\perp Y^m_l}

\newcommand{\Dlt}{D^T_l}

\newcommand{\curlyy}{\bm{\mathcal{Y}}}
\newcommand{\blone}{\beta_{l, 1}}
\newcommand{\blzero}{\beta_{l, 0}}
\newcommand{\blmone}{\beta_{l, -1}}
\newcommand{\chivec}{\bm{\chi}_{1,m_s}}
\newcommand{\cgcoeff}{\mathcal{C}}

\newcommand{\alm}{a_{l,m}}
\newcommand{\blm}{b_{l,m}}
\newcommand{\dlm}{d_{l,m}}
\newcommand{\elm}{e_{l,m}}
\newcommand{\flm}{f_{l,m}}
\newcommand{\glm}{g_{l,m}}
\newcommand{\hlm}{h_{l,m}}
\newcommand{\jlm}{j_{l,m}}
\newcommand{\klm}{k_{l,m}}
\newcommand{\almperp}{a_{l,m}^\perp}
\newcommand{\blmperp}{b_{l,m}^\perp}
\newcommand{\dlmperp}{d_{l,m}^\perp}
\newcommand{\elmperp}{e_{l,m}^\perp}
\newcommand{\flmperp}{f_{l,m}^\perp}
\newcommand{\glmperp}{g_{l,m}^\perp}
\newcommand{\hlmperp}{h_{l,m}^\perp}
\newcommand{\jlmperp}{j_{l,m}^\perp}
\newcommand{\klmperp}{k_{l,m}^\perp}

\newcommand{\unitvec}{\hat{\bm{k}}}


\usepackage{media9}
\graphicspath{ {../sphere/plots} }



\title{Spherical harmonics as orthogonal polynomials in three variables}
\author{Ben Snowball}
%\date{}							% Activate to display a given date or no date


\begin{document}

\maketitle




\section{Introduction}

\sotodoinline{Give outline}
\sotodoinline{Mention shallow water equation. Include plot.}

We use spherical harmonics as orthogonal polynomials in three variables $x, y, z$  to evaluate functions on the sphere. We lay out our derivations behind how we can evaluate a function on the sphere given coefficients of its expansion in the spherical harmonic basis, as well as demonstrate similar work with vector valued functions in the tangent space of the sphere. Finally, we provide details on how these techniques are used in an example of the linear shallow water equations (SWE).

\subsection{On the Unit Interval (1D)}

On the unit interval, \([-1,1]\), we note that there is a hierarchy of orthogonal polynomials (OPs) in the sense that \cite{DLMFJacobiDerivative}:
\begin{align}
& \ddx P^{(a,b)}_l (x) = \text{const.} \times P^{(a+1,b+1)}_{l-1}(x) \\
\implies & \dmdxm P_l(x) = \text{const.} \times P^{(m,m)}_{l-m}(x)
\end{align}
where \(P^{(a,b)}_l (x)\) is the \(l\) degree Jacobi polynomial, orthogonal with weight \(w(x) = (1-x)^a(1+x)^b\), and \(P_l(x) := P^{(0,0)}_l (x)\) is the Legendre polynomial of degree \(l\).

Further, we can define associated Legendre polynomials that are also orthogonal \bstodo{Add reference}:
\begin{align}
\Plm(x) &:= (-1)^m (1-x^2)^\frac{m}{2} \dmdxm P_l(x) = \chat (1-x^2)^\frac{m}{2} P^{(m,m)}_{l-m}(x) \\
P^{-m}_l(x) &:= \ctilde \Plm(x),
\end{align}
for \( m \in \No\) \sotodo{I prefer to write $m = 0,1,2,\ldots$ to avoid any ahance of confusion} where
\begin{align}
\chat &:= \frac{\Gamma(l+m+1)}{(-2)^m\Gamma(l+1)} \\
\ctilde &:= \frac{(-1)^m\Gamma(l-m+1)}{\Gamma(l+m+1)}
\end{align}
using the gamma function \(\Gamma(n) := (n-1)!\) for \(n \in \N\).

\subsection{On the Unit Sphere (3D)}

Let \((x,y,z)\) be a point on the unit sphere such that \(x^2+y^2+z^2 = 1\). Let \(\theta, \varphi\) denote the angles such that
\begin{align}
x &= \sintheta \cosphi \\
y &= \sintheta \sinphi \\
z &= \costheta.
\end{align}
Further, define
\begin{align}
\clm := \Bigg(\frac{(2l+1)\Gamma(l-m+1)}{4\pi\Gamma(l+m+1)}\Bigg)^\frac{1}{2},
\end{align}
and
\begin{align}
\alphalm := \begin{cases} 
		\clm \chatmod \quad \quad \quad \text{if } m \ge 0 \\
		\clm \chatmod \ctildemod \quad \text{if } m < 0
	   \end{cases}.
\end{align}

We can the define the spherical harmonics, orthogonal on the unit sphere as \cite{DLMFSphericalandSpheroidalHarmonics, DLMFFerrers, DLMFAssociatedLegendre}:
\begin{align}
\Ylmfull &:= \clm \eimphi \Plm (\costheta) \\
&= \alphalm (1 - (\costheta)^2)^\frac{|m|}{2} \eimphi P^{(|m|,|m|)}_{l-|m|}(\costheta), \quad \text{where } 0 \le |m| \le l, \, l \in \No.
\end{align} 
Note that we can then express \(\Ylm\) in terms of \(x,y,z\) instead of \(\theta, \varphi\) by noting that \(\costheta = z\) and that \( \eimphi\) can be expressed in terms of \(x,y,z\) for any \(m\in\mathbb{Z}\). Indeed, they are polynomials in $x,y,z$ which we denote $\Ylm(x,y,z)$. They span all polynomials modulo the ideal generated by $x^2 + y^2 + z^2 - 1$.



\section{Surface of the sphere}

\subsection{Deriving expressions for the multiplication by \(x, y, z\) of the spherical harmonics}

We start by expressing \(x\,\Ylm(x,y,z)\), \(y\,\Ylm(x,y,z)\) , and \(z\,\Ylm(x,y,z)\)  in terms of \(Y^{m'}_{l'}(x,y,z)\) for any point \((x,y,z)\) on the unit circle. For the derivation, see the appendix.

\sotodoinline{Move the derivations to an appendix to make the text flow better}

For \(l \in \No\), \(m \in \Z\) s.t. \(0 \le |m| \le l\):
\begin{align}
x\,\Ylm(x,y,z) &= \Alm Y^{m+1}_{l+1}(x,y,z) +  \Blm Y^{m+1}_{l-1}(x,y,z) \nonumber \\
		     & \quad \quad \quad + \Dlm Y^{m-1}_{l+1}(x,y,z) + \Elm Y^{m-1}_{l-1}(x,y,z), \\
y\,\Ylm(x,y,z) &= - i \, \big[\Alm Y^{m+1}_{l+1}(x,y,z) +  \Blm Y^{m+1}_{l-1}(x,y,z) \big] \nonumber \\
		     &\quad \quad \quad + i \, \big[ \Dlm Y^{m-1}_{l+1}(x,y,z) + \Elm Y^{m-1}_{l-1}(x,y,z) \big], \\
z\,\Ylm(x,y,z) &= \Flm Y^{m}_{l+1}(x,y,z) + \Glm Y^{m}_{l-1}(x,y,z) ,
\end{align}
where
\begin{align}
\Alm &:= \begin{cases}
			\frac{\alphalm}{2\alpha^{m+1}_{l+1}} \Atilde \quad \text{if } m\ge0 \\
			\frac{\alphalm}{2\alpha^{m+1}_{l+1}} \tilde{D}_{l,|m|} \quad \text{if } m<0 
	       \end{cases} \\
\Blm &:= \begin{cases}
			\frac{\alphalm}{2\alpha^{m+1}_{l-1}} \Btilde \quad \text{if } m\ge0, \, l - |m| \ge 2 \\
			\frac{\alphalm}{2\alpha^{m+1}_{l-1}} \tilde{E}_{l,|m|} \quad \text{if } m<0 \\
			\quad \quad 0 \quad \quad \quad \quad \text{otherwise.} 
	        \end{cases} \\
\Dlm &:= \begin{cases}
			\frac{\alphalm}{2\alpha^{m-1}_{l+1}} \Dtilde \quad \text{if } m>0 \\
			\frac{\alphalm}{2\alpha^{m-1}_{l+1}} \tilde{A}_{l,|m|} \quad \text{if } m\le0 
	       \end{cases} \\
\Elm &:= \begin{cases}
			\frac{\alphalm}{2\alpha^{m-1}_{l-1}} \Etilde \quad \text{if } m>0 \\
			\frac{\alphalm}{2\alpha^{m-1}_{l-1}} \tilde{B}_{l,|m|} \quad \text{if } m\le0 , \, l - |m| \ge 2 \\
			\quad \quad 0 \quad \quad \quad \quad \text{otherwise.} 
	        \end{cases} \\ 
\Flm &:= \frac{\alphalm}{\alpha^{m}_{l+1}} \Ftilde \\
\Glm &:= \frac{\alphalm}{\alpha^{m}_{l-1}} \Gtilde.
\end{align}


\subsection{Jacobi matrices}

Define, for \(l \in \No\), \(\Pl\) as the column vector of the degree \(l\) spherical harmonic polynomials, and \(\bigP\) as the stacked block vector of the \(\Pl\)'s; that is
\begin{align}
\Pl := \begin{bmatrix}
		Y^{-l}_l \\
		\vdots \\
		Y^l_l
	\end{bmatrix} \in \C^{2l+1}, 
\quad \quad 
\bigP := \begin{bmatrix}
		\bigP_0 \\
		\hline
		\bigP_1 \\
		\hline
		\bigP_2 \\
		\vdots \\
	\end{bmatrix}.
\end{align}

Define the (Jacobi) matrices \(J^x, J^y, J^z\) by 
\begin{align}
J^x \bigP = x \bigP, \quad J^y \bigP = y \bigP, \quad J^z \bigP = z \bigP.
\end{align}
Then, using equations (38--40), we have that the Jacobi matrices take the following block-tridiagonal form:
\begin{align}
J^x &= \begin{bmatrix}
		B^x_0 & A^x_0 & & & & \\
		C^x_1 & B^x_1 & A^x_1 & & & \\
		& C^x_2 & B^x_2 & A^x_2  & & & \\
		& & C^x_3 & \ddots & \ddots & \\
		& & & \ddots & \ddots & \ddots \\
	\end{bmatrix}, \\
J^y &= \begin{bmatrix}
		B^y_0 & A^y_0 & & & & \\
		C^y_1 & B^y_1 & A^y_1 & & & \\
		& C^y_2 & B^y_2 & A^y_2  & & & \\
		& & C^y_3 & \ddots & \ddots & \\
		& & & \ddots & \ddots & \ddots \\
	\end{bmatrix}, \\
J^z &= \begin{bmatrix}
		B^z_0 & A^z_0 & & & & \\
		C^z_1 & B^z_1 & A^z_1 & & & \\
		& C^z_2 & B^z_2 & A^z_2  & & & \\
		& & C^z_3 & \ddots & \ddots & \\
		& & & \ddots & \ddots & \ddots \\
	\end{bmatrix},
\end{align}
where for \(l \in \No\),
\begin{align}
A^x_l &:= \begin{bmatrix}
		D_{l,-l} & 0 & A_{l,-l} & & \\
		& \ddots & \ddots & \ddots & \\
		& & D_{l,l} & 0 & A_{l,l} \\
	    \end{bmatrix} \in \R^{(2l+1)\times(2l+3)}, \\
B^x_l &:= 0 \in \R^{(2l+1)\times(2l+1)} \\
C^x_l &:= \begin{bmatrix}
		B_{l,-l} & & \\
		0 & \ddots & \\
		E_{l,-l+2} & \ddots & B_{l,l-2} \\
		& \ddots & 0 \\
		& & E_{l,l}
	    \end{bmatrix} \in \R^{(2l+1)\times(2l-1)} \quad (l \ne 0), \\
A^y_l &:= -i \begin{bmatrix}
		-D_{l,-l} & 0 & A_{l,-l} & & \\
		& \ddots & \ddots & \ddots & \\
		& & -D_{l,l} & 0 & A_{l,l} \\
	    \end{bmatrix} \in \C^{(2l+1)\times(2l+3)}, \\
B^y_l &:= 0 \in \R^{(2l+1)\times(2l+1)} \\
C^y_l &:= -i \begin{bmatrix}
		B_{l,-l} & & \\
		0 & \ddots & \\
		-E_{l,-l+2} & \ddots & B_{l,l-2} \\
		& \ddots & 0 \\
		& & -E_{l,l}
	    \end{bmatrix} \in \C^{(2l+1)\times(2l-1)} \quad (l \ne 0), \\
A^z_l &:= \begin{bmatrix}
		0 & F_{l,-l} & 0 & & \\
		& \ddots & \ddots & \ddots & \\
		& & 0 & F_{l,l} & 0 \\
	    \end{bmatrix} \in \R^{(2l+1)\times(2l+3)}, \\
B^z_l &:= 0 \in \R^{(2l+1)\times(2l+1)} \\
C^z_l &:= \begin{bmatrix}
		0 & & \\
		G_{l,-l+1} & \ddots & \\
		0 & \ddots & 0 \\
		& \ddots & G_{l,l-1} \\
		& & 0
	    \end{bmatrix} \in \R^{(2l+1)\times(2l-1)} \quad (l \ne 0). \\
\end{align}




\subsection{Three-term recurrence relation for \(\bigP\)}

Combining each system in (48) we can write the tridiagonal-block system
\begin{align}
\renewcommand\arraystretch{1.3}
\mleft[
\begin{array}{c|c|cc}
		1  & & & \\
		\hline 
		B^x_0 - xI_1 & A^x_0 & & \\
		B^y_0 - yI_1 & A^y_0 & & \\
		B^z_0 - zI_1 & A^z_0 & & \\
		\hline 
		C^x_1 & B^x_1 - xI_{3} & \quad A^x_1 \quad & \\
		C^y_1 & B^y_1 - yI_{3} & \quad A^y_1 \quad & \\
		C^z_1 & B^z_1 - zI_{3} & \quad A^z_1 \quad & \\
		\hline
		& C^x_2 & \ddots & \ddots \\
		& C^y_2 & & \\
		& C^z_2 & & \\
		\hline
		& & \ddots &
\end{array}
\mright]
\bigP
=
\begin{bmatrix}
	\alpha^0_0 \\ 0 \\ 0 \\ 0 \\ \\ \vdots \\ \\ \vdots \\ \\ \vdots \\ \\
\end{bmatrix},
\end{align}
where \(I_{2l+1}\) is the \((2l+1)\times(2l+1)\) identity matrix.

Let us define the joint matrices that comprise each block. For each \(l \in \No\):
\begin{align}
A_l &:= \begin{bmatrix}
		A^x_l \\
		A^y_l \\
		A^z_l
	    \end{bmatrix} \in \R^{3(2l+1)\times(2l+3)}, \quad
C_l := \begin{bmatrix}
		C^x_l \\
		C^y_l \\
		C^z_l
	    \end{bmatrix} \in \R^{3(2l+1)\times(2l-1)} \quad (l \ne 0), \\
B_l &:= \begin{bmatrix}
		B^x_l \\
		B^y_l \\
		B^z_l
	    \end{bmatrix} \in \R^{3(2l+1)\times(2l+1)}, \quad
G_l(x,y,z) := \begin{bmatrix}
		xI_{2l+1} \\
		yI_{2l+1} \\
		zI_{2l+1}
	    \end{bmatrix} \in \R^{3(2l+1)\times(2l+1)}.
\end{align}
Then our system (62) simply becomes
\begin{align}
\renewcommand\arraystretch{1.3}
\mleft[
\begin{array}{cccc}
		1  & & & \\
		B_0-G_0(x,y,z) & A_0 & & \\
		C_1 & B_1-G_1(x,y,z) & \quad A_1 \quad & \\
		& C_2 & \ddots & \ddots \\
		& & \ddots &
\end{array}
\mright]
\bigP
=
\begin{bmatrix}
	\alpha^0_0 \\ 0 \\ 0 \\ \vdots \\ \\
\end{bmatrix}.
\end{align}

\sotodoinline{Cite Dunkl and Xu here.}

For each \(l \in \No\) let \(\Dlt\) be any matrix that is a left inverse of \(A_l\), i.e. such that \(\Dlt A_l = I_{2l+3}\). Multiplying our system by the preconditioner matrix that is given by the block diagonal matrix of the \(\Dlt\)'s, we obtain the lower triangular system \citep{dunkl2014orthogonal}
\begin{align}
\renewcommand\arraystretch{1.3}
\mleft[
\begin{array}{cccc}
		1  & & & \\
		D^T_0(B_0-G_0) & I_3 & & \\
		D^T_1 C_1 & D^T_1(B_1-G_1) & \quad I_5 \quad & \\
		& D^T_2 C_2 & \ddots & \ddots \\
		& & \ddots &
\end{array}
\mright]
\bigP
=
\begin{bmatrix}
	\alpha^0_0 \\ 0 \\ 0 \\ \vdots \\ \\
\end{bmatrix}.
\end{align}

Expanding this we can solve the system (66) to find a three-term recurrence relation for each \(\bigP_{l+1}\) in terms of the previous two sub-vectors \(\Pl\) and \(\bigP_{l-1}\):
\begin{align}
\begin{cases}
\bigP_{-1} := 0 \\
\bigP_{0} := \alpha^0_0 \\
\bigP_{l+1} = -\Dlt (B_l-G_l) \Pl - \Dlt C_l  \,\bigP_{l-1}, \quad l \in \N.
\end{cases}
\end{align}

We note that we can choose the matrices \(\Dlt\) in the following way. For \(l \in \N\), we set
\begin{align}
\Dlt = \begin{bmatrix}
		\hat{A}^{x,y}_l & 0_{(2l+3)\times(2l+1)}
	  \end{bmatrix} \in \R^{(2l+3)\times3(2l+1)}
\end{align}
where \(0_{(2l+3)\times(2l+1)}\) the zero matrix in \(\R^{(2l+3)\times(2l+1)}\), and \(\hat{A}^{x,y}_l \in \R^{(2l+3)\times2(2l+1)}\) is the left inverse of the matrix \(\begin{bmatrix} A^x_l \\ A^y_l \end{bmatrix}\), given by
\begin{align}
\hat{A}^{x,y}_l = \begin{bmatrix}
		\frac{1}{2D_{l,-l}} & 0 & \hdots & 0 & -\frac{i}{2D_{l,-l}} & 0 & \hdots & 0 \\
		& \ddots & & & & \ddots & & \\
		& & \ddots & & & & \ddots & \\
		& & & \frac{1}{2D_{l,l}} & 0 & \hdots & 0 & -\frac{i}{2D_{l,l}} \\
		0 & \hdots & \frac{1}{2A_{l,l-1}} & 0 & \hdots & 0 & \frac{i}{2A_{l,l-1}} & 0 \\
		0 & \hdots & 0 & \frac{1}{2A_{l,l}} & 0 & \hdots & 0 & \frac{i}{2A_{l,l}}
	  \end{bmatrix}.
\end{align}
For \(l = 0\) we set
\begin{align}
D^T_0 = \begin{bmatrix}
		\frac{1}{2D_{0,0}}&  -\frac{i}{2D_{0,0}} & 0 \\
		0 & 0 & \frac{1}{F_{0,0}} \\
		\frac{1}{2A_{0,0}}&  \frac{i}{2A_{0,0}} & 0 
	     \end{bmatrix}.
\end{align}




\subsection{Evaluation of a scalar function on the sphere}
We can use the Clenshaw algorithm to evaluate a function at a given point \((x,y,z)\) on the unit sphere provided we know the coefficients of the function when expanded in the spherical harmonic basis, i.e. suppose \(f(x,y,z)\) is a function and we know the set \(\{\bold{f}_l\}\) s.t.
\begin{align}
f(x,y,z) \approx \sum^N_{l=0} \bold{f}_l^T \, \Pl (x,y,z), \quad \text{where } \Pl (x,y,z), \bold{f}_l \in \R^{2l+1} \text{ for each } l \in \{0,\dots,N\}.
\end{align}

The Clenshaw algorithm is then as follows:
\begin{align*}
\quad &\text{1) } \text{Set } \bm{\gamma}_{N+2} = \bold{0}, \: \bm{\gamma}_{N+2} = \bold{0}. \\
\quad &\text{2) } \text{For } n = N:-1:1 \\
\quad & \quad \quad \quad \text{set } \bm{\gamma}_{n}^T = \bold{f}_n^T - \bm{\gamma}_{n+1}^T D^T_n (B_n - G_n(x,y,z)) -  \bm{\gamma}_{n+2}^T D^T_{n+1}C_{n+1} \\
\quad &\text{3) } \text{Output: } f(x,y,z) \approx \bigP_0(x,y,z) f_0 + \bm{\gamma}_{1}^T \bigP_1(x,y,z) - \bigP_0(x,y,z) \bm{\gamma}_{2}^T D^T_1 C_1.
\end{align*}
where $\bigP_0 \equiv \alpha^0_0$.

\sotodoinline{Mention $a(J^x, J^y, J^z)$ for variable coefficients here. Mention it is banded-block-banded.}
We can use the same algorithm to output a matrix operator for a function, given we know the coefficients of its expansion in the SH basis. We simply make the adjustment that
\begin{align*}
\quad &\text{1) } \text{Set } \bm{\gamma}_{N+2} = \bold{0}, \: \bm{\gamma}_{N+2} = \bold{0}. \\
\quad &\text{2) } \text{For } n = N:-1:1 \\
\quad & \quad \quad \quad \text{set } \bm{\gamma}_{n}^T = (\bold{f}_n^T)I - \bm{\gamma}_{n+1}^T D^T_n (B_n - G_n(J^x,J^y,J^z)) -  \bm{\gamma}_{n+2}^T D^T_{n+1}C_{n+1} \\
\quad &\text{3) } \text{Output: } f(x,y,z) \approx \alpha^0_0 f_0 + \bm{\gamma}_{1}^T \bigP_1(J^x,J^y,J^z) - \alpha^0_0 \bm{\gamma}_{2}^T D^T_1 C_1.
\end{align*}
where $\bigP_1(J^x,J^y,J^z)$ is a vector of matrices, $G_n(J^x,J^y,J^z)$ is a matrix of matrices, and so each $\bm{\gamma}_n$ is a vector of matrices.




\section{Tangent space}

Since the spherical harmonics are a basis for the surface of the sphere, and the tangent space of the sphere is spanned by the gradient  and perpendicular gradient of a scalar function, we have that the gradients and perpendicular gradients of the spherical harmonics are a basis for the tangent space, namely \(\gradYlm\), \(\gradpYlm\). Note that the perpendicular gradient is related to the regular surface gradient by
\begin{align}
\gradpYlm(x,y,z) = \unitvec \times \gradYlm(x,y,z),
\end{align}
where \(\unitvec\) is the unit vector normal to the surface of the sphere at the point \((x,y,z)\), i.e. as we are looking at the unit sphere, \(\unitvec\) is simply given by
\begin{align}
\unitvec = \begin{bmatrix} x \\ y \\ z \end{bmatrix}.
\end{align}

Importantly,  \(\gradYlm\), \(\gradpYlm\) are in fact vector-valued orthogonal polynomials, that span all vector-valued polynomials modulo the vanishing ideal $\{ \bm{p} \in (\Pi_3)^3  : \unitvec \cdot \bm{p} = 0 \}$. A simple calculation shows that such orthogonal polynomials must still have block-tridiagonal Jacobi operators, as multiplication by $x, y$, or $z$ remains inside the ideal. In the following, we determine the coefficients of these Jacobi operators, as well as other important operators needed.



\subsection{Spin-1 tensor spherical harmonics}

The gradient and perpendicular gradient of a spherical harmonic \(\Ylm(x,y,z)\) can be expressed in terms of spin-1 tensor spherical harmonics, which in turn can each be expressed as a vector-weighted sum of spherical harmonics. For the derivation and more on vector spherical harmonics, see the appendix.

For any \(l \in \No\), \(m \in \Z\) s.t. \(0 \le |m| \le l\) we have that
\begin{align}
\nabla \Ylm &= \blmone \, \curlyy^{l-1,1}_{l,m} + \blone \curlyy^{l+1,1}_{l,m}, \\
\nabla^\perp \Ylm &= \blzero \, \curlyy^{l,1}_{l,m},
\end{align}
where
\begin{align}
\blmone &:= (l+1) \, \Big(\frac{l}{2l+1}\Big)^\half, \quad
\blzero := i \, \big(l(l+1)\big)^\half, \quad
\blone := l \, \Big(\frac{l+1}{2l+1}\Big)^\half.
\end{align}

\sotodoinline{I think the following should also be moved to appendix because it's technical details}



\subsection{Deriving expressions for the multiplication by \(x, y, z\) of \(\nabla \Ylm\), \(\nabla^\perp \Ylm\) }

We start by establishing some equations to be used to find \(x \,\gradYlm (x,y,z)\), \(x \,\gradpYlm (x,y,z)\) etc. in terms of \(\gradY^{m'}_{l'} (x,y,z)\), \(\gradpY^{m'}_{l'} (x,y,z)\). First, we have that
\begin{align}
x \,\gradYlm 
&= x \, \blmone \, \curlyy^{l-1,1}_{l,m} + x \, \blone \curlyy^{l+1,1}_{l,m} \nonumber
\\
&= \sum_{m_s=-1}^{1} \chivec \Big[ \blmone \, \cgcoeff^{l-1,m_s}_{l,m} \big\{ A_{l-1,m-m_s} \, Y^{m-m_s+1}_{l} + B_{l-1,m-m_s} \, Y^{m-m_s+1}_{l-2} \nonumber \\ 
& \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad + D_{l-1,m-m_s} \, Y^{m-m_s-1}_{l} + E_{l-1,m-m_s} \, Y^{m-m_s-1}_{l-2} \big\} \nonumber \\
& \quad \quad \quad \quad \quad \quad \quad + \blone \, \cgcoeff^{l+1,m_s}_{l,m} \big\{ A_{l+1,m-m_s} \, Y^{m-m_s+1}_{l+2} + B_{l+1,m-m_s} \, Y^{m-m_s+1}_{l} \nonumber \\ 
& \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad + D_{l+1,m-m_s} \, Y^{m-m_s-1}_{l+2} + E_{l+1,m-m_s} \, Y^{m-m_s-1}_{l} \big\} \Big]
\end{align}
\begin{align}
\implies x \,\gradYlm &= \alm \gradY^{m+1}_{l+1} + \blm \gradY^{m+1}_{l-1} + \dlm \gradY^{m-1}_{l+1} + \elm \gradY^{m-1}_{l-1} \nonumber \\
& \quad \quad \quad + \hlm \gradpY^{m+1}_{l} + \jlm \gradpY^{m-1}_{l},
\end{align}
where, for any valid \(m_s\) value,
\begin{align}
\alm &:= \frac{\blone}{\beta_{l+1,1}} \frac{\cgcoeff^{l+1,m_s}_{l,m}}{\cgcoeff^{l+2,m_s}_{l+1,m+1}} A_{l+1,m-m_s}, \\
\blm &:= \frac{\blmone}{\beta_{l-1,-1}} \frac{\cgcoeff^{l-1,m_s}_{l,m}}{\cgcoeff^{l-2,m_s}_{l-1,m+1}} B_{l-1,m-m_s}, \\
\dlm &:= \frac{\blone}{\beta_{l+1,1}} \frac{\cgcoeff^{l+1,m_s}_{l,m}}{\cgcoeff^{l+2,m_s}_{l+1,m-1}} D_{l+1,m-m_s}, \\
\elm &:= \frac{\blmone}{\beta_{l-1,-1}} \frac{\cgcoeff^{l-1,m_s}_{l,m}}{\cgcoeff^{l-2,m_s}_{l-1,m-1}} E_{l-1,m-m_s}, \\
\hlm &:= \frac{1}{\blzero \, \cgcoeff^{l,m_s}_{l, m+1}} \, \Big[ \cgcoeff^{l-1,m_s}_{l,m} \, \blmone \, A_{l-1,m-m_s} + \cgcoeff^{l+1,m_s}_{l,m} \, \blone \, B_{l+1,m-m_s} \nonumber \\
& \quad \quad \quad \quad \quad \quad \quad - \alm \, \beta_{l+1,-1} \, \cgcoeff^{l,m_s}_{l+1,m+1} - \blm \, \beta_{l-1,1} \, \cgcoeff^{l,m_s}_{l-1,m+1} \Big], \\
\jlm &:= \frac{1}{\blzero \, \cgcoeff^{l,m_s}_{l, m-1}} \, \Big[ \cgcoeff^{l-1,m_s}_{l,m} \, \blmone \, D_{l-1,m-m_s} + \cgcoeff^{l+1,m_s}_{l,m} \, \blone \, E_{l+1,m-m_s} \nonumber \\
& \quad \quad \quad \quad \quad \quad \quad - \dlm \, \beta_{l+1,-1} \, \cgcoeff^{l,m_s}_{l+1,m-1} - \elm \, \beta_{l-1,1} \, \cgcoeff^{l,m_s}_{l-1,m-1} \Big].
\end{align}

Note that (it can be shown) these are constants for each \(l,m\) pair despite appearing to depend on the value of \(m_s\); we need only use any valid \(m_s\) value for each expression. By ``valid'', we mean the Clebsch--Gordan coefficients do not vanish for that \(m_s\) value when used. 

Similarly, we have that
\begin{align}
y \,\gradYlm &= i \, \Big[ -\alm \gradY^{m+1}_{l+1} - \blm \gradY^{m+1}_{l-1} + \dlm \gradY^{m-1}_{l+1} + \elm \gradY^{m-1}_{l-1} \nonumber \\
& \quad \quad \quad - \hlm \gradpY^{m+1}_{l} + \jlm \gradpY^{m-1}_{l} \Big].
\end{align}

Further, we also have that
\begin{align}
z \,\gradYlm 
&= z \, \blzero \, \curlyy^{l,1}_{l,m} \nonumber
\\
&= \sum_{m_s=-1}^{1} \chivec \Big[ \blmone \, \cgcoeff^{l-1,m_s}_{l,m} \big\{ F_{l-1,m-m_s} \, Y^{m-m_s}_{l} + G_{l-1,m-m_s} \, Y^{m-m_s}_{l-2} \big\} \nonumber \\ 
& \quad \quad \quad \quad \quad \quad \quad + \blone \, \cgcoeff^{l+1,m_s}_{l,m} \big\{ F_{l+1,m-m_s} \, Y^{m-m_s}_{l+2} + G_{l+1,m-m_s} \, Y^{m-m_s}_{l} \big\} \Big]
\end{align}
\begin{align}
\implies z \,\gradYlm &= \flm \gradY^{m}_{l+1} + \glm \gradY^{m}_{l-1} + \klm \gradpY^{m}_{l},
\end{align}
where, for any valid \(m_s\) value,
\begin{align}
\flm &:= \frac{\blone}{\beta_{l+1,1}} \frac{\cgcoeff^{l+1,m_s}_{l,m}}{\cgcoeff^{l+2,m_s}_{l+1,m+1}} F_{l+1,m-m_s}, \\
\glm &:= \frac{\blmone}{\beta_{l-1,-1}} \frac{\cgcoeff^{l-1,m_s}_{l,m}}{\cgcoeff^{l-2,m_s}_{l-1,m+1}} G_{l-1,m-m_s}, \\
\klm &:= \frac{1}{\blzero \, \cgcoeff^{l,m_s}_{l, m}} \, \Big[ \cgcoeff^{l-1,m_s}_{l,m} \, \blmone \, F_{l-1,m-m_s} + \cgcoeff^{l+1,m_s}_{l,m} \, \blone \, G_{l+1,m-m_s}  \nonumber \\
& \quad \quad \quad \quad \quad \quad \quad - \flm \, \beta_{l+1,-1} \, \cgcoeff^{l,m_s}_{l+1,m} - \glm \, \beta_{l-1,1} \, \cgcoeff^{l,m_s}_{l-1,1} \Big].
\end{align}

We can similarly yield the relations for the perpendicular gradients:
\begin{align}
x \,\gradpYlm &= \almperp \gradpY^{m+1}_{l+1} + \blmperp \gradpY^{m+1}_{l-1} + \dlmperp \gradpY^{m-1}_{l+1} + \elmperp \gradpY^{m-1}_{l-1} \nonumber \\
& \quad \quad \quad + \hlmperp \gradY^{m+1}_{l} + \jlmperp \gradY^{m-1}_{l}, \\
y \,\gradpYlm &= i \, \Big[ -\almperp \gradpY^{m+1}_{l+1} - \blmperp \gradpY^{m+1}_{l-1} + \dlmperp \gradpY^{m-1}_{l+1} + \elmperp \gradpY^{m-1}_{l-1} \nonumber \\
& \quad \quad \quad - \hlmperp \gradY^{m+1}_{l} + \jlmperp \gradY^{m-1}_{l}, \\
z \,\gradpYlm &= \flmperp \gradpY^{m}_{l+1} + \glmperp \gradpY^{m}_{l-1} + \klmperp \gradY^{m}_{l},
\end{align}
where it can be shown that
\begin{align}
\almperp &= \alm^*, \quad \blmperp = \blm^*, \quad \dlmperp = \dlm^*, \quad \elmperp = \elm^*, \nonumber \\
\flmperp = \flm^*,& \quad \glmperp = \glm^*, \quad \hlmperp = \hlm^*, \quad \jlmperp = \jlm^*, \quad \klmperp = \klm^*,
\end{align}
where \(^*\) denotes the complex conjugate.



\subsection{Jacobi matrices}

Define \(\gradP\) \sotodo{This notation could be confusing. I'd say use either $T{\mathbb P}$ or ${\mathbb P}^T$} as the column vector
\begin{align}
\gradP = \begin{bmatrix} \gradP_0 \\ \gradP_1 \\ \vdots \end{bmatrix}, \quad \text{where } \quad \gradP_l = \begin{bmatrix} \gradY^{-l}_l \\ \gradpY^{-l}_l \\ \vdots \\ \gradY^{l}_l \\ \gradpY^{l}_l  \end{bmatrix} \quad \forall \: l \in \No.
\end{align}

Further, let
\begin{align}
\bold{u}^c = \begin{bmatrix}
			\bold{u}_0^c \\
			\bold{u}_1^c \\
			\vdots \\
		    \end{bmatrix},		  
\quad
\text{where}
\quad
\bold{u}^c_l &= \begin{bmatrix}
				u_{l,-l} \\
				u^{\perp}_{l,-l} \\
				\vdots \\
				u_{l,l} \\
				u^{\perp}_{l,l}
		        \end{bmatrix} \in \R^{2(2l+1)} \quad \forall l = 0,1,2,\dots
\end{align}

We can define the Jacobi operators \(J_\nabla^x, J_\nabla^y, J_\nabla^z\) as follows. Let $S := \{ \bold{x} := (x,y,z) \quad | \quad ||\bold{x}|| = 1\}$ be the unit sphere in $\R^3$ and $\mathbf{u}(x,y,z)$ be a function on $S$ with vector values in the tangent space. That is, there exist coefficients $\{u_{l,m}, u^\perp_{l,m}\}$ such that, $\forall (x,y,z) \in S$:
\begin{align}
\mathbf{u}(x,y,z) &= \sum_{l=0}^\infty \sum_{m=-l}^l \big( u_{l,m} \gradYlm(x,y,z) + u^\perp_{l,m} \gradpYlm(x,y,z) \big) \\
&= (\mathbf{u}^c)^T \gradP(x,y,z)
\end{align}

Then \(J_\nabla^x\) is defined as the matrix such that 
\begin{align}
x \mathbf{u}(x,y,z) = \sum_{l=0}^\infty \sum_{m=-l}^l \big( \tilde{u}_{l,m} \gradYlm(x,y,z) + \tilde{u}^\perp_{l,m} \gradpYlm(x,y,z) \big), \quad \forall (x,y,z) \in S,
\end{align}
where
\begin{align}
(J_\nabla^x)^T \mathbf{u}^c = \mathbf{\tilde{u}}^c,
\quad
\bold{\tilde{u}}^c = \begin{bmatrix}
			\bold{\tilde{u}}_0^c \\
			\bold{\tilde{u}}_1^c \\
			\vdots \\
		    \end{bmatrix},		  
\quad
\text{and}
\quad
\bold{\tilde{u}}^c_l &= \begin{bmatrix}
				\tilde{u}_{l,-l} \\
				\tilde{u}^{\perp}_{l,-l} \\
				\vdots \\
				\tilde{u}_{l,l} \\
				\tilde{u}^{\perp}_{l,l}
		        \end{bmatrix} \quad \forall l = 0,1,2,\dots,
\end{align}
and \(J_\nabla^y, J_\nabla^z\) are defined similarly.

In other words, abusing notation, we can write that
\begin{align}
J_\nabla^x \gradP = x \gradP, \quad J_\nabla^y \gradP = y \gradP, \quad J_\nabla^z \gradP = z \gradP,
\end{align}
where each sub-vector entry \(\gradYlm\) and \(\gradpYlm\) of \(\gradP\) is treated as a single element of the vector \(\gradP\) in the matrix-vector calculation. \sotodo{I don't know what this means}

The Jacobi matrices have the following form:
\begin{align}
J_\nabla^x &= \begin{bmatrix}
		B^x_0 & A^x_0 & & & & \\
		C^x_1 & B^x_1 & A^x_1 & & & \\
		& C^x_2 & B^x_2 & A^x_2  & & & \\
		& & C^x_3 & \ddots & \ddots & \\
		& & & \ddots & \ddots & \ddots \\
	\end{bmatrix}, \\
J_\nabla^y &= \begin{bmatrix}
		B^y_0 & A^y_0 & & & & \\
		C^y_1 & B^y_1 & A^y_1 & & & \\
		& C^y_2 & B^y_2 & A^y_2  & & & \\
		& & C^y_3 & \ddots & \ddots & \\
		& & & \ddots & \ddots & \ddots \\
	\end{bmatrix}, \\
J_\nabla^z &= \begin{bmatrix}
		B^z_0 & A^z_0 & & & & \\
		C^z_1 & B^z_1 & A^z_1 & & & \\
		& C^z_2 & B^z_2 & A^z_2  & & & \\
		& & C^z_3 & \ddots & \ddots & \\
		& & & \ddots & \ddots & \ddots \\
	\end{bmatrix},
\end{align}
where for \(l \in \No\),

\begin{align}
A^x_l &:= \begin{bmatrix}
		d_{l,-l} & 0 & 0 & 0 & a_{l,-l} & & \\
		& d^\perp_{l,-l} & 0 & 0 & 0 & a_{l,-l} & & \\
		& & \ddots & \ddots & \ddots & \ddots & \ddots & \\
		& & & d_{l,l} & 0 & 0 & 0 & a_{l,l} \\
		& & & & d^\perp_{l,l} & 0 & 0 & 0 & a^\perp_{l,-l}  \\
	    \end{bmatrix} \in \R^{2(2l+1)\times2(2l+3)}, 
\end{align}
\begin{align}
B^x_l &:= \begin{bmatrix}
		0 & 0 & 0 & h_{l,-l} & & \\
		0 & 0 & h^\perp_{l,-l} & 0 & & \\
		0 & j_{l,-l+1} & 0 & 0 & 0 & h_{l,-l+1} \\
		j^\perp_{l,-l+1} & 0 & 0 & 0 & h^\perp_{l,-l+1} & 0 \\
		& \ddots & & \ddots & & \ddots \\
		& & \ddots & & \ddots & & \ddots \\
		& & 0 & j_{l,l-1} & 0 & 0 & 0 & h_{l,l-1} \\
		& & j^\perp_{l,l-1} & 0 & 0 & 0 & h^\perp_{l,l-1} & 0 \\
		& & & & 0 & j_{l,l} & 0 & 0 \\
		& & & & j^\perp_{l,l} & 0 & 0 & 0 \\
	\end{bmatrix}  \in \R^{2(2l+1)\times2(2l+1)}, 
\end{align}
\begin{align}
C^x_l &:= \begin{bmatrix}
		b_{l,-l} & & \\
		0 & b^\perp_{l,-l} \\
		0 & 0 & \ddots & \\
		0 & 0 & \ddots & \ddots \\
		e_{l,-l+2} & 0 & \ddots & \ddots & b_{l,l-2} \\
		& e^\perp_{l,-l+2} & \ddots & \ddots & 0 & b^\perp_{l,l-2} \\
		& & \ddots & \ddots & 0 & 0 \\
		& & & \ddots & 0 & 0 \\
		& & & & e_{l,l} & 0 \\
		& & & & & e^\perp_{l,l} \\
	    \end{bmatrix} \in \R^{2(2l+1)\times2(2l-1)} \quad (l \ne 0),
\end{align}
\begin{align}
A^y_l &:= \begin{bmatrix}
		-d_{l,-l} & 0 & 0 & 0 & a_{l,-l} & & \\
		& -d^\perp_{l,-l} & 0 & 0 & 0 & a_{l,-l} & & \\
		& & \ddots & \ddots & \ddots & \ddots & \ddots & \\
		& & & -d_{l,l} & 0 & 0 & 0 & a_{l,l} \\
		& & & & -d^\perp_{l,l} & 0 & 0 & 0 & a^\perp_{l,-l}  \\
	    \end{bmatrix} \in \R^{2(2l+1)\times2(2l+3)},
\end{align}
\begin{align}
B^y_l &:= \begin{bmatrix}
		0 & 0 & 0 & h_{l,-l} & & \\
		0 & 0 & h^\perp_{l,-l} & 0 & & \\
		0 & -j_{l,-l+1} & 0 & 0 & 0 & h_{l,-l+1} \\
		-j^\perp_{l,-l+1} & 0 & 0 & 0 & h^\perp_{l,-l+1} & 0 \\
		& \ddots & & \ddots & & \ddots \\
		& & \ddots & & \ddots & & \ddots \\
		& & 0 & -j_{l,l-1} & 0 & 0 & 0 & h_{l,l-1} \\
		& & -j^\perp_{l,l-1} & 0 & 0 & 0 & h^\perp_{l,l-1} & 0 \\
		& & & & 0 & -j_{l,l} & 0 & 0 \\
		& & & & -j^\perp_{l,l} & 0 & 0 & 0 \\
		\end{bmatrix}  \in \R^{2(2l+1)\times2(2l+1)}, 
\end{align}
\begin{align}
C^y_l &:= \begin{bmatrix}
		b_{l,-l} & & \\
		0 & b^\perp_{l,-l} \\
		0 & 0 & \ddots & \\
		0 & 0 & \ddots & \ddots \\
		-e_{l,-l+2} & 0 & \ddots & \ddots & b_{l,l-2} \\
		& -e^\perp_{l,-l+2} & \ddots & \ddots & 0 & b^\perp_{l,l-2} \\
		& & \ddots & \ddots & 0 & 0 \\
		& & & \ddots & 0 & 0 \\
		& & & & -e_{l,l} & 0 \\
		& & & & & -e^\perp_{l,l} \\
	    \end{bmatrix} \in \R^{2(2l+1)\times2(2l-1)} \quad (l \ne 0),
\end{align}
\begin{align}
A^z_l &:= \begin{bmatrix}
		0 & 0 & f_{l,-l} \\
		& & & f^\perp_{l,-l} \\
		& & & & \ddots \\
		& & & & & f_{l,l} \\
		& & & & & & f^\perp_{l,l} & 0 & 0 \\
	    \end{bmatrix} \in \R^{2(2l+1)\times2(2l+3)}, \\
\end{align}
\begin{align}
B^z_l &:= \begin{bmatrix}
		0 & k_{l,-l} \\
		k^\perp_{l,-l} & 0 \\
		& & \ddots \\
		& & & 0 & k_{l,l} \\
		& & & k^\perp_{l,l} & 0 \\
	\end{bmatrix}  \in \R^{2(2l+1)\times2(2l+1)}, 
\end{align}
\begin{align}
C^z_l &:= \begin{bmatrix}
		0 \\
		0 \\
		g_{l,-l+1} \\
		& g^\perp_{l,-l+1} \\
		& & \ddots \\
		& & & g_{l,l-1} \\
		& & & & g^\perp_{l,l-1} \\
		& & & & 0 \\
		& & & & 0 \\
	    \end{bmatrix} \in \R^{2(2l+1)\times2(2l-1)} \quad (l \ne 0). \\
\end{align}



\subsection{Three-term recurrence relation for \(\gradP\)}

Combining each system in (102) we can write, for \((x,y,z)\) on the unit sphere, the tridiagonal-block system\sotodo{Is $0_3$ wrong below?}
\begin{align}
\renewcommand\arraystretch{1.3}
\mleft[
\begin{array}{c|c|c|cc}
		I_{2}  & & & \\
		\hline
		& I_{6}  & & & \\
		\hline 
		& B^x_1 - xI_6 & A^x_1 & & \\
		& B^y_1 - yI_6 & A^y_1 & & \\
		& B^z_1 - zI_6 & A^z_1 & & \\
		\hline 
		& C^x_2 & B^x_2 - xI_{10} & \quad A^x_2 \quad & \\
		& C^y_2 & B^y_2 - yI_{10} & \quad A^y_2 \quad & \\
		& C^z_2 & B^z_2 - zI_{10} & \quad A^z_2 \quad & \\
		\hline
		& & C^x_3 & \ddots & \ddots \\
		& & C^y_3 & & \\
		& & C^z_3 & & \\
		\hline
		& & & \ddots &
\end{array}
\mright]
\gradP
=
\begin{bmatrix}
	\underline{0}_3 \\ \underline{0}_3 \\ \gradP_1 \\ \underline{0}_3 \\ \\ \vdots \\ \\ \vdots \\ \\ \vdots \\ \\
\end{bmatrix},
\end{align}
where \(I_{2l+1}\) is the \((2l+1)\times(2l+1)\) identity matrix. For clarity we again treat each sub-vector \(\gradYlm, \gradpYlm\) of \(\gradP\) in the matrix-vector multiplication as a single element.

Let us define the joint matrices that comprise each block. For each \(l \in \N\):
\begin{align}
A_l &:= \begin{bmatrix}
		A^x_l \\
		A^y_l \\
		A^z_l
	    \end{bmatrix} \in \R^{6(2l+1)\times2(2l+3)}, \quad
C_l := \begin{bmatrix}
		C^x_l \\
		C^y_l \\
		C^z_l
	    \end{bmatrix} \in \R^{6(2l+1)\times2(2l-1)} \quad (l \ne 1), \\
B_l &:= \begin{bmatrix}
		B^x_l \\
		B^y_l \\
		B^z_l
	    \end{bmatrix} \in \R^{6(2l+1)\times2(2l+1)}, \quad
G_l(x,y,z) := \begin{bmatrix}
		xI_{2(2l+1)} \\
		yI_{2(2l+1)} \\
		zI_{2(2l+1)}
	    \end{bmatrix} \in \R^{6(2l+1)\times2(2l+1)}.
\end{align}
Then our system simply becomes
\begin{align}
\renewcommand\arraystretch{1.3}
\mleft[
\begin{array}{cccc}
		I_2 \\
		0 & I_6 & & \\
		C_1 & B_1-G_1 & A_1 \quad & \\
		& C_2 & \ddots & \ddots \\
		& & \ddots &
\end{array}
\mright]
\gradP
=
\begin{bmatrix}
	\underline{0}_3 \\ \underline{0}_3 \\ \gradP_1 \\ \underline{0}_3 \\ \\ \vdots \\
\end{bmatrix}.
\end{align}

For each \(l \in \N\) let \(\Dlt\) be any matrix that is a left inverse of \(A_l\), i.e. such that \(\Dlt A_l = I_{2(2l+3)}\). Multiplying our system by the preconditioner matrix that is given by the block diagonal matrix of the \(\Dlt\)'s, we obtain the lower triangular system
\begin{align}
\renewcommand\arraystretch{1.3}
\mleft[
\begin{array}{cccc}
		I_2 \\
		0 & I_6 & & \\
		D^T_1 C_1 & D^T_1(B_1-G_1) & \quad I_{10} \quad & \\
		& D^T_2 C_2 & \ddots & \ddots \\
		& & \ddots &
\end{array}
\mright]
\gradP
=
\begin{bmatrix}
	\underline{0}_3 \\ \underline{0}_3 \\ \gradP_1 \\ \underline{0}_3 \\ \\ \vdots \\
\end{bmatrix}.
\end{align}

Expanding this we can find a three-term recurrence relation for each \(\gradP_{l+1}\) in terms of the previous two sub-vectors \(\gradPl\) and \(\gradP_{l-1}\):
\begin{align}
\begin{cases}
\gradP_{0}(x,y,z) := \underline{0}_6 \\
\\
\gradP_{1}(x,y,z) := \begin{bmatrix}
				\gradY_1^{-1}(x,y,z) \\ \gradpY_1^{-1}(x,y,z) \\ \gradY_1^{0}(x,y,z) \\ \gradpY_1^{0}(x,y,z) \\ \gradY_1^{1}(x,y,z) \\ \gradpY_1^{1}(x,y,z) \\
			\end{bmatrix} \\
\\
\gradP_{l+1}(x,y,z) = -\Dlt [B_l-G_l(x,y,z)] \gradPl(x,y,z) - \Dlt C_l  \,\gradP_{l-1}(x,y,z), \quad l \in \N.
\end{cases}
\end{align}

We note that we can choose the matrices \(\Dlt\) in the following way. For \(l \in \N\), we set
\begin{align}
\Dlt = \begin{bmatrix}
		\hat{A}^{x,y}_l & 0_{2(2l+3)\times2(2l+1)}
	  \end{bmatrix} \in \R^{2(2l+3)\times6(2l+1)}
\end{align}
where \(0_{2(2l+3)\times2(2l+1)}\) the zero matrix in \(\R^{2(2l+3)\times2(2l+1)}\), and \(\hat{A}^{x,y}_l \in \R^{2(2l+3)\times4(2l+1)}\) is the left inverse of the matrix \(\begin{bmatrix} A^x_l \\ A^y_l \end{bmatrix}\), given by
\begin{align}
\hat{A}^{x,y}_l = \begin{bmatrix}
		\frac{1}{2d_{l,-l}} & 0 & \hdots & 0 & -\frac{i}{2d_{l,-l}} & 0 & \hdots &  \\
		0 & \frac{1}{2d^\perp_{l,-l}} & 0 & \hdots & 0 & -\frac{i}{2d^\perp_{l,-l}} & 0 & \hdots &  \\
		& & \ddots & & & & \ddots & & \\
		\vdots & & & \ddots & & & & \ddots & \\
		& & & & \frac{1}{2d_{l,l}} & 0 & \hdots & 0 & -\frac{i}{2d_{l,l}} & \\
		& & & & & \frac{1}{2d^\perp_{l,l}} & 0 & \hdots & 0 & -\frac{i}{2d^\perp_{l,l}} \\
		0 & \hdots & \frac{1}{2a_{l,l-1}} & 0 & \hdots & 0 & \frac{i}{2a_{l,l-1}} & 0 & 0 & 0 \\
		0 & \hdots & 0 & \frac{1}{2a^\perp_{l,l-1}} & 0 & \hdots & 0 & \frac{i}{2a^\perp_{l,l-1}} & 0 & 0\\
		0 & \hdots & \hdots & 0 & \frac{1}{2a_{l,l}} & 0 & \hdots & 0 & \frac{i}{2a_{l,l}} & 0 \\
		0 & \hdots & \hdots & & 0 & \frac{1}{2a^\perp_{l,l}} & 0 & \hdots & 0 & \frac{i}{2a^\perp_{l,l}} \\
	  \end{bmatrix}.
\end{align}


\subsection{Evaluation of a vector valued function in the tangent space on the sphere}

We can use the Clenshaw algorithm again to evaluate a vector valued function in the tangent space at a point $(x,y,z) \in S$. Suppose
\begin{align}
\mathbf{u}(x,y,z) \approx \sum^N_{l=0} \sum^l_{m=-l} \big[u_{l,m} \, \gradYlm(x,y,z)  + u^\perp_{l,m} \, \gradpYlm(x,y,z) \big].
\end{align}

The Clenshaw algorithm is then as follows:
\begin{align*}
\quad &\text{1) } \text{Set } \bm{\gamma}_{N+2} = \bold{0}, \: \bm{\gamma}_{N+2} = \bold{0}. \\
\quad &\text{2) } \text{For } n = N:-1:1 \\
\quad & \quad \quad \quad \text{set } \bm{\gamma}_{n}^T = (\mathbf{u}^c_n)^T - \bm{\gamma}_{n+1}^T D^T_n (B_n - G_n) -  \bm{\gamma}_{n+2}^T D^T_{n+1}C_{n+1} \\
\quad &\text{3) } \text{Output: } \mathbf{u}(x,y,z) \approx \bm{\gamma}_{1}^T \gradP_1(x,y,z) \\
&\quad \quad \quad \quad \Big( = (\bm{\gamma}_{1})_1 \gradY_1^{-1} + (\bm{\gamma}_{1})_2 \gradpY_1^{-1} + (\bm{\gamma}_{1})_3 \gradY_1^{0} + (\bm{\gamma}_{1})_4 \gradpY_1^{0} + (\bm{\gamma}_{1})_5 \gradY_1^{1} + (\bm{\gamma}_{1})_6 \gradpY_1^{1} \Big)
\end{align*}




\subsection{Deriving matrices and calculations for certain operations}

Define \(\unitvec\) as the unit outward normal vector at the point on the sphere \((x,y,z)\), so that
\begin{align}
\unitvec = \begin{bmatrix} x \\ y \\ z \end{bmatrix}.
\end{align}

Let \(S := \{ \bold{x} := (x,y,z) \quad | \quad ||\bold{x}|| = 1\}\) be the unit sphere in \(\R^3\) and let \(T_x^S\) denote the tangent space at the point \(\bold{x} \in S\). Further, let \(\bold{u}(x,y,z)\), \(\bold{v}(x,y,z)\) be two vector valued functions for \((x,y,z)\) on the unit sphere with values in the tangent space (representing the tangential velocity of a flow for example) and let \(h(x,y,z)\) be a scalar function on the sphere.

Then, 
\begin{align}
\bold{u} &= \sum_{l=0}^{\infty} \sum_{m=-l}^{l} [ u_{l,m} \gradYlm + u^{\perp}_{l,m} \gradpYlm ], \\
\bold{v} &= \sum_{l=0}^{\infty} \sum_{m=-l}^{l} [ v_{l,m} \gradYlm + v^{\perp}_{l,m} \gradpYlm ], \\
h &= \sum_{l=0}^{\infty} \sum_{m=-l}^{l} h_{l,m} \Ylm,
\end{align}
for some real coefficients \(u_{l,m}, u^{\perp}_{l,m}, v_{l,m}, v^{\perp}_{l,m}, h_{l,m}\). Define the vectors of these coefficients as 
\begin{align}
\bold{u}^c &= \begin{bmatrix}
			\bold{u}_0^c \\
			\bold{u}_1^c \\
			\vdots \\
		    \end{bmatrix},
\quad
\bold{v}^c = \begin{bmatrix}
			\bold{v}_0^c \\
			\bold{v}_1^c \\
			\vdots \\
		    \end{bmatrix},
\quad
\bold{h}^c = \begin{bmatrix}
			\bold{h}_0^c \\
			\bold{h}_1^c \\
			\vdots \\
		    \end{bmatrix},		  
\end{align}
where
\begin{align}
\bold{u}^c_l &= \begin{bmatrix}
				u_{l,-l} \\
				u^{\perp}_{l,-l} \\
				\vdots \\
				u_{l,l} \\
				u^{\perp}_{l,l}
		        \end{bmatrix},
\quad
\bold{v}^c_l = \begin{bmatrix}
				v_{l,-l} \\
				v^{\perp}_{l,-l} \\
				\vdots \\
				v_{l,l} \\
				v^{\perp}_{l,l}
		        \end{bmatrix},
\quad
\bold{h}^c_l = \begin{bmatrix}
				h_{l,-l} \\
				\vdots \\
				h_{l,l} \\
		        \end{bmatrix},
\quad \forall l \in \No	  
\end{align}.

Then, for large enough \(N \in \N\) we have that
\begin{align}
\bold{u} &\approx \sum_{l=0}^{N} \sum_{m=-l}^{l} [ u_{l,m} \gradYlm + u^{\perp}_{l,m} \gradpYlm ], \\
\bold{v} &\approx \sum_{l=0}^{N} \sum_{m=-l}^{l} [ v_{l,m} \gradYlm + v^{\perp}_{l,m} \gradpYlm ], \\
h &\approx \sum_{l=0}^{N} \sum_{m=-l}^{l} h_{l,m} \Ylm,
\end{align}
and so we define the truncated coefficient vectors for some \(N \in \N\) as
\begin{align}
\bold{u}^c &= \begin{bmatrix}
			\bold{u}_0^c \\
			\bold{u}_1^c \\
			\vdots \\
			\bold{u}_N^c
		    \end{bmatrix},
\quad
\bold{v}^c = \begin{bmatrix}
			\bold{v}_0^c \\
			\bold{v}_1^c \\
			\vdots \\
			\bold{v}_N^c
		    \end{bmatrix},
\quad
\bold{h}^c = \begin{bmatrix}
			\bold{h}_0^c \\
			\bold{h}_1^c \\
			\vdots \\
			\bold{h}_N^c
		    \end{bmatrix}.		  
\end{align}

We note that
\begin{align}
\gradpYlm = \unitvec \times \gradYlm, \quad \forall \; l \in \No, \; m \in \Z \; \text{s.t.} \; |m| \le l.
\end{align}


\sotodo{Isn't there a name for this Operator? Maybe "Unit Curl Operator"?}
\subsubsection{Unit Curl Operator}
\begin{align}
\unitvec \times \bold{u} &= \unitvec \times \sum_{l=0}^{\infty} \sum_{m=-l}^{l} [ u_{l,m} \gradYlm + u^{\perp}_{l,m} \gradpYlm ] \\
&= \sum_{l=0}^{\infty} \sum_{m=-l}^{l} [ u_{l,m} \unitvec \times \gradYlm + u^{\perp}_{l,m} \unitvec \times \gradpYlm ] \\
&= \sum_{l=0}^{\infty} \sum_{m=-l}^{l} [ u_{l,m} \unitvec \times \gradYlm + u^{\perp}_{l,m} \unitvec \times ( \unitvec \times \gradYlm ) ] \\
&= \sum_{l=0}^{\infty} \sum_{m=-l}^{l} [ u_{l,m} \gradpYlm + u^{\perp}_{l,m} (( \unitvec \cdot \gradpYlm) \unitvec - ( \unitvec \cdot \unitvec ) \gradYlm ) ] \\
&= \sum_{l=0}^{\infty} \sum_{m=-l}^{l} [ u_{l,m} \gradpYlm - u^{\perp}_{l,m} \gradYlm ) ]. \\
\end{align}

Thus the operator matrix for the cross product from the left by the normal unit vector at the point \((x,y,z)\) is given by
\begin{align}
K =  \begin{bmatrix}
		0 & -1 & & & & \\
		1 & 0 & & & & \\
		& & 0 & -1 & & \\
		& & 1 & 0 & & \\
		& & & & \ddots \\
		& & & & & \ddots 
	  \end{bmatrix} \quad \in \quad \R^{2(N+1)^2 \times 2(N+1)^2}.
\end{align}
so that \(K\bold{u}^c\) gives the vector of coefficients for for expansion of \(\unitvec \times \bold{u}\) in the vector spherical harmonic basis (up to degree N).


\subsubsection{Operator for Div}
\begin{align}
\nabla \cdot \bold{u} &= \nabla \cdot \Big( \sum_l \sum_{m=-l}^{l} [ u_{l,m} \gradYlm + u^{\perp}_{l,m} \gradpYlm ] \Big) \\
&= \sum_l \sum_{m=-l}^{l} [ u_{l,m} \: \Delta \Ylm + u^{\perp}_{l,m} \nabla \cdot (\unitvec \times \gradYlm) ] \\
&= \sum_l \sum_{m=-l}^{l} u_{l,m} \: \Delta \Ylm \\
&= \sum_l \sum_{m=-l}^{l} - u_{l,m} \: l(l+1) \Ylm, \\
\end{align}
using the fact that 
\begin{align}
\Delta \Ylm(x,y,z) = -l(l+1)\Ylm(x,y,z), \quad \forall \; l \in \No, \; m \in \Z \; \text{s.t.} \; |m| \le l.
\end{align}

Thus, the operator matrix for the divergence of a vector in the tangent space is
\begin{align}
D &=  \begin{bmatrix}
		-l(l+1)|_{l=0} & 0 & & & & & & & \\
		& & -l(l+1)|_{l=1} & 0 & & & & & \\
		& & & & -l(l+1)|_{l=1} & 0 & & & \\
		& & & & & & -l(l+1)|_{l=1} & 0 & \\
		& & & & & & & \ddots 
	  \end{bmatrix} \\
	  &=  \begin{bmatrix}
		0 & 0 & & & & & & & \\
		& & -2 & 0 & & & & & \\
		& & & & -2 & 0 & & & \\
		& & & & & & -2 & 0 & \\
		& & & & & & & \ddots 
	  \end{bmatrix} \quad \in \quad \R^{(N+1)^2 \times 2(N+1)^2},
\end{align}
so that \(D\bold{u}^c\) gives the vector of coefficients of the expansion for \(\nabla \cdot u\) in the spherical harmonic basis.


\subsubsection{Operator for Grad}
\begin{align}
\nabla h &= \nabla \Big( \sum_l \sum_{m=-l}^{l} h_{l,m} \Ylm \Big) \\
&= \sum_l \sum_{m=-l}^{l} h_{l,m} \gradYlm
\end{align}

Thus, the operator matrix for the gradient of a scalar function on the sphere is
\begin{align}
G &=  \begin{bmatrix}
		\tilde{G_0} & & & \\
		& \tilde{G_1} & & \\
		& & \tilde{G_2} & \\
		& & & \ddots
	  \end{bmatrix}  \quad \in \quad \R^{2(N+1)^2 \times (N+1)^2},
\end{align}
where
\begin{align}
\tilde{G_l} &=  \begin{bmatrix}
		1 & & & \\
		0 & & & \\
		& 1 & & \\
		& 0 & & \\
		& & 1 & \\
		& & 0 & \\
		& & & \ddots \\
	  \end{bmatrix} \quad \in \quad \R^{2(2l+1) \times (2l+1)},
\end{align}
so that \(G\bold{h}^c\) gives the vector of coefficients of the expansion for \(\nabla h\) in the tangent space (vector spherical harmonic) basis.


\subsubsection{Dot products}

We consider the general case that \(\bold{u}\) is expanded up to order \(N_1 \in \N\) and \(\bold{v}\) is expanded up to order \(N_2 \in \N\), i.e. 
\begin{align}
\bold{u}^c &= \begin{bmatrix}
			\bold{u}_0^c \\
			\bold{u}_1^c \\
			\vdots \\
			\bold{u}_{N_1}^c
		    \end{bmatrix},
\quad
\bold{v}^c = \begin{bmatrix}
			\bold{v}_0^c \\
			\bold{v}_1^c \\
			\vdots \\
			\bold{v}_{N_2}^c
		    \end{bmatrix}.
\end{align}

Let \((x,y,z)\) lie on the unit sphere and let \(l = 1\), \(m \in {-1, 0, 1}\) and define \(\tilde{N} := N_1 + N_2\). Then
\begin{align}
\gradYlm(x,y,z) \cdot \bold{v}(x,y,z) = (\bold{b}^c)^T  \: \bigP(x,y,z)
\end{align}
where
\begin{align}
\bigP &:= \begin{bmatrix}
		\bigP_0 \\
		\bigP_1 \\
		\bigP_2 \\
		\vdots \\
		\bigP_{N_2}
	  \end{bmatrix}, \quad 
\Pl := \begin{bmatrix}
		Y_l^{-l} \\
		\vdots \\	
		Y_l^l
	  \end{bmatrix},
\end{align}
for some coefficient vector \(\bold{b}^c \in \R^{(N_2+1)^2}\). In other words, the dot product of one of the \(l=1\) tangent space's orthogonal polynomials with a vector valued function on the unit sphere can naturally be written as an expansion in the scalar spherical harmonic OP basis. Similarly,
\begin{align}
\gradpYlm(x,y,z) \cdot \bold{v}(x,y,z) = (\bold{b^\perp}^c)^T  \: \bigP(x,y,z)
\end{align}
for some coefficient vector \(\bold{b^\perp}^c \in \R^{(N_2+2)^2}\).

Then, 
\begin{align}
\bold{b}^c &= J_{l,m} \: \bold{v}^c, \quad 
\bold{b^\perp}^c = J^\perp_{l,m} \: \bold{v}^c
\end{align}
where \(J_{l,m}\), \(J^\perp_{l,m}\) are (operator) matrices for the dot product with \(\gradYlm(x,y,z)\) and \(\gradpYlm(x,y,z)\) respectively.
Each \(J_{l,m}\), \(J^\perp_{l,m}\) will have the \((\tilde{N} \times N_2)\) block structure:
\begin{align}
	\begin{array}{c|c|c|c}
		1 \times 6 & 1 \times 10 & \\
		\hline
		3 \times 6 & 3 \times 10 & 3 \times 14 & \\
		\hline
		5 \times 6 & 5 \times 10 & 5 \times 14 & \ddots \\
		\hline
		&  7 \times 10 & 7 \times 14 & \ddots \\
		\hline
		& & \ddots & \ddots \\
	  \end{array}
\end{align}
i.e. a {\tt BandedBlockBandedMatrix(J, (rows, cols), (2,1), (?,?))} [note: I am not sure what the sub-block bands should be] where 
\begin{verbatim}
    rows = 1:2:2N+1 
    cols = 6:4:2(2N_2+1).
\end{verbatim}

Define
\begin{align}
\mathbb{T}^\bigP_0 &:= 0, \quad
\mathbb{T}^\bigP_1 := \begin{bmatrix}
			J_{1,-1} \\
			J^\perp_{1,-1} \\
			J_{1,0} \\
			J^\perp_{1,0} \\
			J_{1,1} \\
			J^\perp_{1,1}
	  	\end{bmatrix}.
\end{align}
Then by linearity of the dot product, we can use the recurrence relation (122) for \(\gradPl\) to gain a recurrence for \(\mathbb{T}^\bigP_l\):
\begin{align}
\mathbb{T}^\bigP_{l+1} = -\Dlt [B_l-G_l(J^x, J^y, J^z)] \: \mathbb{T}^\bigP_l - \Dlt C_l  \, \mathbb{T}^\bigP_{l-1}, \quad l \in \{1,\dots,N_1-1\},
\end{align}
where \(J^x, J^y, J^z\) are the \(\tilde{N} \times \tilde{N}\) Jacobi operator matrices for multiplication of the scalar spherical harmonic basis by \(x, y, z\) respectively. We then have that for each \(l \in {1,\dots,N_1}\),
\begin{align}
\mathbb{T}^\bigP_l := \begin{bmatrix}
			J_{l,-l} \\
			J^\perp_{l,-l} \\
			\vdots \\
			J_{l,l} \\
			J^\perp_{l,l}
	  	\end{bmatrix}.
\end{align}

Then, 
\begin{align}
\bold{u}(x,y,z) \cdot \bold{v}(x,y,z) = (\bold{b}^c)^T  \: \bigP(x,y,z)
\end{align}
where \(\bold{b}^c \in \R^{(\tilde{N}+1)^2}\) and is given by
\begin{align}
\bold{b}^c = \Big(\sum_{l=0}^{N_1} \sum_{m=-l}^{l} [ u_{l,m} J_{l,m} + u^{\perp}_{l,m} J^\perp_{l,m} ] \Big) \: \bold{v}^c.
\end{align}


\subsection{Example}

Let $\mathbf{u}(x,y,z)$ be the tangential velocity of the flow and $h(x,y,z)$ be the height of the water from some constant reference height $\mathcal{H}$. The linear SWEs are
\begin{align}
\begin{cases}
\frac{\partial \mathbf{u}}{\partial t} + f \unitvec \times \mathbf{u} - \nabla h = \mathbf{0} \\
\frac{\partial h}{\partial t} + \mathcal{H} \nabla \cdot \mathbf{u} = 0
\end{cases}
\end{align}
where $f = 2 \Omega \cos(\theta) =  2 \Omega z$ is the Coriolis parameter (note that the operator on the coefficients vector for multiplication by this parameter would be $F = 2 \Omega (J^z_\nabla)^T$).

Using backward Euler:
\begin{align}
\mathbf{u}_{n+1} &= \mathbf{u}_{n} + \Delta t \: (\nabla h_{n+1} - f \unitvec \times \mathbf{u}_{n+1}) \\
h_{n+1} &= h_n - \Delta t \: \mathcal{H} \nabla \cdot \mathbf{u}_{n+1}
\end{align}

Then using the operators on the coefficient vectors, the timestepping method is: 
\begin{align}
\mathbf{u}^c_{n+1} &= \mathbf{u}^c_{n} + \Delta t \: (G \mathbf{h}^c_{n+1} - F K \mathbf{u}^c_{n+1}) \\
\mathbf{h}^c_{n+1} &= \mathbf{h}^c_n - \Delta t \: \mathcal{H} D \mathbf{u}^c_{n+1}
\end{align}
$\iff$
\begin{align}
\mathbf{u}^c_{n+1} &= (I + \Delta t F K + \Delta t^2 \mathcal{H} G D)^{-1} \: (\mathbf{u}^c_{n} + \Delta t \: G \mathbf{h}^c_n) \\
\mathbf{h}^c_{n+1} &= \mathbf{h}^c_n - \Delta t \: \mathcal{H} D \mathbf{u}^c_{n+1}
\end{align}

\bstodo{Image}




\section{Appendix}

\subsection{Derivation of multiplication by $x,y,z$ relationships for the spherical harmonics}

Using (7)--(9), we can write \sotodo{Add references to the DLMF. Be precise about which equation as it makes it easier for yourself to look up.}
\begin{align}
\Ylm(x,y,z) &= \alphalm (1 - z^2)^\frac{|m|}{2} \eimphi P^{(|m|,|m|)}_{l-|m|}(z), \quad \text{where } 0 \le |m| \le l, \, l \in \No.
\end{align}

Note that the recurrence relationship for the Jacobi polynomials satisfies \cite{DLMFJacobiRecurrence}
\begin{align}
z P^{(m,m)}_k(z) = \frac{1}{\kappa_{k,m}} \big[ P^{(m,m)}_{k+1}(z) - \lambda_{k,m} P^{(m,m)}_k(z) + \mu_{k,m} P^{(m,m)}_{k-1}(z) \big],
\end{align}
for \(k\ge0, \, m\in\Z\), where
\begin{align}
\kappa_{k,m} &:= \frac{(2k+2m+1)(k+m+1)}{(k+1)(k+2m+1)}, \\
\lambda_{k,m} &:= 0\\
\mu_{k,m} &:= \frac{k+m+1}{(k+1)(k+2m+1)}.
\end{align}
Thus,
\begin{align}
z P^{(m,m)}_{l-m}(z) = \Ftilde P^{(m,m)}_{l-m+1}(z) + \Gtilde P^{(m,m)}_{l-m-1}(z),
\end{align}
for \(k\ge0, \, m\in\Z\), where
\begin{align}
\Ftilde &:= \frac{(l-m+1)(l+m+1)}{(2l+1)(l+1)}, \\
\Gtilde &:= \begin{cases}
			\frac{l}{2l+1} \quad \text{if } l - m \ge 1 \\
			\quad 0 \quad \quad \text{otherwise.}
		\end{cases} .
\end{align}

Further, note that
\begin{align}
\cosphi \, \eimphi &= \frac{1}{2} (e^{i\varphi} + e^{-i\varphi}) \eimphi =  \frac{1}{2} (e^{i(m+1)\varphi} + e^{i(m-1)\varphi}) \\
\sinphi \, \eimphi &= \frac{1}{2i} (e^{i\varphi} - e^{-i\varphi}) \eimphi =  \frac{-i}{2} (e^{i(m+1)\varphi} - e^{i(m-1)\varphi})
\end{align}

Finally, note the relationship between the Jacobi polynomials \(P^{(a,b)}_{l}(z)\) and the ultraspherical polynomials \(C^{(\lambda)}_{n}(z)\) \cite{DLMFUltraJacobi}, as well as the three-term recurrence relation for the ultraspherical polynomials \cite{DLMFUltraRecurrence, DLMFUltraRecurrence2}, i.e. for \(m \in \No\):
\begin{align}
\nu_{l,m} C^{(m+1/2)}_{l-m}(z) = P^{(m,m)}_{l-m}(z),
\end{align}
and
\begin{align}
C^{(\lambda)}_n(z) &= \xi^{(1)}_{n, \lambda} \big[ C^{(\lambda+1)}_n(z) - C^{(\lambda+1)}_{n-2}(z) \big]  \\
(1-z^2) \, C^{(\lambda)}_n(z) &= \frac{1}{\xi^{(2)}_{n, \lambda}} \big[ \xi^{(3)}_{n, \lambda} C^{(\lambda-1)}_n(z) - \xi^{(4)}_{n, \lambda}C^{(\lambda-1)}_{n+2}(z) \big] ,
\end{align}
where
\begin{align}
\nu_{l,m} &:= \frac{\Gamma(l+1)\Gamma(2m+1)}{\Gamma(l+m+1)\Gamma(m+1)} \\
\xione&:= \frac{\lambda}{n+\lambda} \\
\xitwo &:= 4(\lambda-1)(n+\lambda) \\
\xithree &:= (n+2\lambda-2)(n+2\lambda-1) \\
\xifour &:= (n+1)(n+2).
\end{align}

Thus, we can write three-term recurrences for the Jacobi polynomials as:
\begin{align}
P^{(m,m)}_{l-m}(z) &= \Atilde P^{(m+1,m+1)}_{l-m}(z) + \Btilde P^{(m+1,m+1)}_{l-m-2}(z) \\
(1-z^2) \, P^{(m,m)}_{l-m}(z) &= \Dtilde P^{(m-1,m-1)}_{l-m+2}(z) + \Etilde P^{(m-1,m-1)}_{l-m}(z),
\end{align}
for \(l, m \in \No\) s.t. \(0 \le m \le l\), where
\begin{align}
\Atilde &:= \frac{(l+m+2)(l+m+1)}{2(2l+1)(l+1)} \\
\Btilde &:= \begin{cases}
			- \frac{l}{2(2l+1)} \quad \text{if } l - m \ge 2 \\
			\quad \quad 0 \quad \quad \text{otherwise.}
		\end{cases} \\
\Dtilde &:= - \frac{2(l-m+2)(l-m+1)}{(2l+1)(l+1)} \\
\Etilde &:= \frac{2l}{2l+1} .
\end{align}

We can now write down expressions for the multiplication of \(\Ylm(x,y,z)\) by \(x, y \) or \(z\) for some point \((x,y,z)\) on the unit sphere for \(l \in \No\), \(m \in \Z\) s.t. \(0 \le |m| \le l\) as follows:
\begin{align}
x\,\Ylm(x,y,z) &= \alphalm \cosphi \eimphi \sintheta (1-z^2)^{|m|/2} P^{(|m|,|m|)}_{l-|m|}(z) \nonumber \\
		     &= \half \alphalm (e^{i(m+1)\varphi} + e^{i(m-1)\varphi}) (1-z^2)^{\frac{|m|+1}{2}} P^{(|m|,|m|)}_{l-|m|}(z) \nonumber \\
		     &= \half \alphalm e^{i(m+1)\varphi} (1-z^2)^{\frac{|m|+1}{2}} \big[ \Atilde P^{(|m|+1,|m|+1)}_{l-|m|}(z) + \Btilde P^{(|m|+1,|m|+1)}_{l-|m|-2}(z) \big] \nonumber \\
		     &\quad \quad +  \half \alphalm e^{i(m-1)\varphi} (1-z^2)^{\frac{|m|-1}{2}} \big[ \Dtilde P^{(|m|-1,|m|-1)}_{l-|m|+2}(z) + \Etilde P^{(|m|-1,|m|-1)}_{l-|m|}(z) \big] \nonumber \\
		     &= \Alm Y^{m+1}_{l+1}(x,y,z) +  \Blm Y^{m+1}_{l-1}(x,y,z) \nonumber \\
		     & \quad \quad \quad + \Dlm Y^{m-1}_{l+1}(x,y,z) + \Elm Y^{m-1}_{l-1}(x,y,z),
\end{align}
\begin{align}
y\,\Ylm(x,y,z) &= \alphalm \sinphi \eimphi \sintheta (1-z^2)^{|m|/2} P^{(|m|,|m|)}_{l-|m|}(z) \nonumber \\
		     &= -\half i \alphalm (e^{i(m+1)\varphi} - e^{i(m-1)\varphi}) (1-z^2)^{\frac{|m|+1}{2}} P^{(|m|,|m|)}_{l-|m|}(z) \nonumber \\
		     &= - i \, \big[\Alm Y^{m+1}_{l+1}(x,y,z) +  \Blm Y^{m+1}_{l-1}(x,y,z) \big] \nonumber \\
		     &\quad \quad \quad + i \, \big[ \Dlm Y^{m-1}_{l+1}(x,y,z) + \Elm Y^{m-1}_{l-1}(x,y,z) \big],
\end{align}
\begin{align}
z\,\Ylm(x,y,z) &= \alphalm \eimphi (1-z^2)^{|m|/2} z P^{(|m|,|m|)}_{l-|m|}(z) \nonumber \\
		     &= \alphalm \eimphi (1-z^2)^{|m|/2} \big[ \Ftilde P^{(|m|,|m|)}_{l-|m|+1}(z) + \Gtilde P^{(|m|,|m|)}_{l-|m|-1}(z) \big]\nonumber \\
		     &= \Flm Y^{m}_{l+1}(x,y,z) + \Glm Y^{m}_{l-1}(x,y,z) ,
\end{align}
where
\begin{align}
\Alm &:= \begin{cases}
			\frac{\alphalm}{2\alpha^{m+1}_{l+1}} \Atilde \quad \text{if } m\ge0 \\
			\frac{\alphalm}{2\alpha^{m+1}_{l+1}} \tilde{D}_{l,|m|} \quad \text{if } m<0 
	       \end{cases} \\
\Blm &:= \begin{cases}
			\frac{\alphalm}{2\alpha^{m+1}_{l-1}} \Btilde \quad \text{if } m\ge0, \, l - |m| \ge 2 \\
			\frac{\alphalm}{2\alpha^{m+1}_{l-1}} \tilde{E}_{l,|m|} \quad \text{if } m<0 \\
			\quad \quad 0 \quad \quad \quad \quad \text{otherwise.} 
	        \end{cases} \\
\Dlm &:= \begin{cases}
			\frac{\alphalm}{2\alpha^{m-1}_{l+1}} \Dtilde \quad \text{if } m>0 \\
			\frac{\alphalm}{2\alpha^{m-1}_{l+1}} \tilde{A}_{l,|m|} \quad \text{if } m\le0 
	       \end{cases} \\
\Elm &:= \begin{cases}
			\frac{\alphalm}{2\alpha^{m-1}_{l-1}} \Etilde \quad \text{if } m>0 \\
			\frac{\alphalm}{2\alpha^{m-1}_{l-1}} \tilde{B}_{l,|m|} \quad \text{if } m\le0 , \, l - |m| \ge 2 \\
			\quad \quad 0 \quad \quad \quad \quad \text{otherwise.} 
	        \end{cases} \\ 
\Flm &:= \frac{\alphalm}{\alpha^{m}_{l+1}} \Ftilde \\
\Glm &:= \frac{\alphalm}{\alpha^{m}_{l-1}} \Gtilde.
\end{align}


\subsection{Vector spherical harmonics}

We start by defining what we mean by a spin-1 tensor spherical harmonic. In general, the tensor spherical harmonic is given by, for \(2l, \, j, \, 2s \in \No\),
\begin{align}
\curlyy^{j,s}_{l,m}(x,y,z) = \sum_{m_s=-s}^s \langle j \quad m-m_s \; ; \; s \quad m_s \; | \; l \quad m \rangle \, Y^{m-m_s}_j (x,y,z) \, \bm{\chi}_{s, m_s},
\end{align}
where \(\bm{\chi}_{s, m_s}\) are the simultaneous eigenstates of the spin operators \(\bold{S}^2\) and \(S_z\), and where \(\langle j \quad m-m_s \; ; \; s \quad m_s \; | \; l \quad m \rangle\) \sotodo{This notation is hard to read.} is a Clebsch-Gordan coefficient. We note that a property of the Clebsch--Gordan coefficients means that they vanish unless \(|j - s| \le l \le j + s\). We further note that there are simple calculable expressions for the Clebsch--Gordan coefficients when the spin \(s=1\).

To simplify the notation, for spin $s=1$, we define
\begin{align}
\cgcoeff^{L, m_s}_{l, m} := \, \langle L \quad m-m_s \; ; \; 1 \quad m_s \; | \; l \quad m \rangle.
\end{align}

Thus we have that the three spin-1 tensor spherical harmonics are given by
\begin{align}
\curlyy^{l \pm1,s}_{l,m}(x,y,z) &= \sum_{m_s=-1}^1 \cgcoeff^{l\pm1, m_s}_{l, m} \, Y^{m-m_s}_{l \pm 1} (x,y,z) \, \chivec, \\
\curlyy^{l,s}_{l,m}(x,y,z) &= \sum_{m_s=-1}^1 \cgcoeff^{l, m_s}_{l, m} \, Y^{m-m_s}_l (x,y,z) \, \chivec.
\end{align}

Here, the vectors \(\chivec\) are the orthonormal eigenvectors of the matrix  \sotodo{Fix}
\begin{align}
S_3 = \begin{bmatrix} 0 & -i & 0 \\ i & 0 & 0 \\ 0 & 0 & 0 \end{bmatrix},
\end{align}
and so are given as
\begin{align}
\bm{\chi}_{1, \pm 1} = \frac{1}{\sqrt{2}} \begin{bmatrix} \mp 1 \\ -i \\ 0 \end{bmatrix}, \quad \bm{\chi}_{1,0} = \begin{bmatrix} 0 \\ 0 \\ 1 \end{bmatrix}.
\end{align}

Then, for any \(l \in \No\), \(m \in \Z\) s.t. \(0 \le |m| \le l\) we have that
\begin{align}
\nabla \Ylm &= \blmone \, \curlyy^{l-1,1}_{l,m} + \blone \curlyy^{l+1,1}_{l,m}, \\
\nabla^\perp \Ylm &= \blzero \, \curlyy^{l,1}_{l,m},
\end{align}
where
\begin{align}
\blmone &:= (l+1) \, \Big(\frac{l}{2l+1}\Big)^\half, \quad
\blzero := i \, \big(l(l+1)\big)^\half, \quad
\blone := l \, \Big(\frac{l+1}{2l+1}\Big)^\half.
\end{align}





\bibliography{spherical-harmonics-bib}


\end{document}











  