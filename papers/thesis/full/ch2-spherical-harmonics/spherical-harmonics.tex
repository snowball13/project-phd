

\chapter{Spherical harmonics as orthogonal polynomials}


To introduce ourselves to the world of multidimensional orthogonal polynomials for solving PDEs on the sphere, we can naturally choose to look at the famous spherical harmonics. Our aim here is to express the spherical harmonics as polynomials in three variables $x, y, z$ to evaluate functions and solve PDEs on the whole sphere. More precisely, we desire the solution to partial differential equations on the domain
\bseqn{
	\Omega := \bsset{(x,y,z) \in \R^3}{x^2 + y^2 = \rho(z)^2}
}
where 
\bseqn{
	\rho(z) := \sqrt{1-z^2}.
}
While it may seem somewhat odd, it should hopefully become apparent why this is a useful way to define our domain. 


\section{Defining the spherical harmonics in three variables}

Before we proceed further, let's build up to our definition of the spherical harmonics. We first need to introduce a few classical orthogonal polynomials.

On the unit interval, $[-1,1]$, we note that there is a hierarchy of orthogonal polynomials (OPs) in the sense that \cite[table 18.3.1, eqn 18.9.15]{DLMF}:
\bseqn{
	& \ddx{x} P^{(a,b)}_l (x) = \half \: (l + a + b + 1) \: P^{(a+1,b+1)}_{l-1}(x) \\
	\implies & \dmdxm{x}{m} P_l(x) = {(l+m)! \over 2^m \: l!} \: P^{(m,m)}_{l-m}(x)
}
where $P^{(a,b)}_l (x)$ is the $l$ degree \textit{Jacobi polynomial}, and $P_l(x) := P^{(0,0)}_l (x)$ is simply the \textit{Legendre polynomial} of degree $l$. Jacobi polynomials are orthogonal with weight $w(x) = (1-x)^a(1+x)^b$; that is for $l, l' \in \No,$
\bseqn{
	\int_{-1}^1 {P^{(a,b)}_l(x)}^2 \:(1-x)^a(1+x)^b \: \D x &=: \omega_{P,l}^{(a,b)} \\
	\int_{-1}^1 P^{(a,b)}_l(x) \: P^{(a,b)}_{l'}(x) \:(1-x)^a(1+x)^b \: \D x &= \omega_{P,l}^{(a,b)} \: \delta_{l, l'}.
}
Further, the \textit{associated Legendre polynomials} are a set of polynomials orthogonal with respect to unit weight on the unit interval, and are given by \bstodo{Add citation for associated legendre polys}:
\bseqn{
	\Plm(x) &:= (-1)^m (1-x^2)^\frac{m}{2} \dmdxm{x}{m} P_l(x) = \chat (1-x^2)^\frac{m}{2} P^{(m,m)}_{l-m}(x) \\
	P^{-m}_l(x) &:= \ctilde \Plm(x),
}
for $m = 0, 1, 2, \dots, l$ where
\bseqn{
	\chat &:= {(l+m)! \over (-2)^m \; l!} \\
	\ctilde &:= {(-1)^m \: (l-m)! \over (l+m)!}
}
and $n! := n \: (n-1) \: (n-2) \dots 1$ for $n \in \N$ is the standard factorial. Further, define
\bseqnnumber{
	\clm := \Bigg({(2l+1) \: (l-m)! \over 4 \pi \: (l+m)!}\Bigg)^\frac{1}{2} \:
		\begin{cases} 
			\chat \quad \quad \quad \text{if } m \ge 0 \\
			\chatmod \ctildemod \quad \text{if } m < 0
		\end{cases}. \label{eqn:clmdef}
}
This allows us to explicitly see where the normalising constants that we shall be using for our definition of the spherical harmonics come from. 

Let $(x,y,z) \in \Omega$. It is useful to be able to transform between these cartesian coordinates and the spherical coordinates ($\varphi, \theta$). On this note, throughout we will use the convention that the spherical coordinate angles be defined by
\bseqn{
	x &= \sinphi \costheta = \rho(z) \costheta \\
	y &= \sinphi \sintheta = \rho(z) \sintheta \\
	z &= \cosphi.
}
We can now write down the spherical harmonics. We will use the standard definition -- that is, the spherical harmonics, orthonormal on the unit sphere, are \cite[14.30.1]{DLMF}:
\bseqnnumber{
	\Ylmfull &:= \Bigg({(2l+1) \: (l-m)! \over 4 \pi \: (l+m)!}\Bigg)^\frac{1}{2} \: \eimtheta \Plm (\cosphi) \nonumber \\
	&= \clm (1 - (\cosphi)^2)^\frac{|m|}{2} \eimtheta P^{(|m|,|m|)}_{l-|m|}(\cosphi) \nonumber \\
	&= \clm P^{(|m|,|m|)}_{l-|m|}(z) \: \rho(z)^{|m|} \: \eimtheta \label{eqn:shdef}
}
for $0 \le |m| \le l, \, l \in \No$ where $\clm$ is defined in \bsrefeqn{eqn:clmdef}, and
\bseqn{
	&\int_0^{2\pi} \int_0^\pi \Ylmfull \: {Y_{l'}^{m'}(\varphi, \theta)}^{*} \: \sinphi \: \D \varphi \: \D \theta \\
	& \quad = 2\pi \: \delta_{m, m'} \: \clm \: c_{l'}^{m'} \: \int_{-1}^1 P^{(|m|,|m|)}_{l-|m|}(z) \: P^{(|m|,|m|)}_{l'-|m|}(z) \: \rho(z)^{2|m|} \: \D z \\
	& \quad = \delta_{l, l'} \: \delta_{m, m'}.
}
where $\alpha^*$ denotes the complex conjugate of $\alpha \in \C$. Note how we can express the spherical harmonics $\Ylm$ in terms of $x,y,z$ instead of $\varphi, \theta$ by noting that $\rho(z)^{|m|} \eimtheta$ can be expressed in terms of $x,y,z$ for any $m\in\mathbb{Z}$. Indeed, they are polynomials in $x,y,z$ which we denote $\Ylm(x,y,z)$. They span all polynomials modulo the ideal generated by $x^2 + y^2 + z^2 - 1$.



\section{Jacobi matrices}

Jacobi operators that correspond to multiplication of the orthogonal polynomial basis, in this case the spherical harmonics, by our cartesian coordinates $x, y, z$. We start by expressing $x\,\Ylm(x,y,z)$, $y\,\Ylm(x,y,z)$ , and $z\,\Ylm(x,y,z)$ in terms of $Y^{m'}_{l'}(x,y,z)$ for any point $(x,y,z)$ on the unit sphere.

\begin{lemma}
	For $l \in \No$, $m \in \Z$ s.t. $0 \le |m| \le l$, the spherical harmonics satisfy the relationships:
\bseqnnumber{
	x\,\Ylm(x,y,z) &= \alpha_{l,m,1} Y^{m-1}_{l-1}(x,y,z) +  \alpha_{l,m,2} Y^{m+1}_{l-1}(x,y,z) \nonumber \\
		     & \quad \quad \quad + \alpha_{l,m,3} Y^{m-1}_{l+1}(x,y,z) + \alpha_{l,m,4} Y^{m+1}_{l+1}(x,y,z), \label{eqn:shrecx} \\
	y\,\Ylm(x,y,z) &= \beta_{l,m,1} Y^{m-1}_{l-1}(x,y,z) +  \beta_{l,m,2} Y^{m+1}_{l-1}(x,y,z) \nonumber \\
		     & \quad \quad \quad + \beta_{l,m,3} Y^{m-1}_{l+1}(x,y,z) + \beta_{l,m,4} Y^{m+1}_{l+1}(x,y,z), \label{eqn:shrecy} \\
	z\,\Ylm(x,y,z) &= \gamma_{l,m,1} Y^{m}_{l-1}(x,y,z) + \gamma_{l,m,2} Y^{m}_{l+1}(x,y,z), \label{eqn:shrecz}
}
where
\bseqn{
	\alpha_{l,m,1} &:= 
		\begin{cases}
			\frac{\clm}{2c^{m-1}_{l-1}} \tilde \alpha_{l,m,1} \quad \text{if } m>0 \\
			\frac{\clm}{2c^{m-1}_{l-1}} \tilde \alpha_{l,|m|,2} \quad \text{if } m\le0 , \, l - |m| \ge 2 \\
			\quad \quad 0 \quad \quad \quad \quad \text{otherwise} 
		\end{cases} \\ 
	\alpha_{l,m,2} &:= 
		\begin{cases}
			\frac{\clm}{2c^{m+1}_{l-1}} \tilde \alpha_{l,m,2} \quad \text{if } m\ge0, \, l - |m| \ge 2 \\
			\frac{\clm}{2c^{m+1}_{l-1}} \tilde \alpha_{l,|m|,1} \quad \text{if } m<0 \\
			\quad \quad 0 \quad \quad \quad \quad \text{otherwise} 
		\end{cases} \\
	\alpha_{l,m,3} &:= 
		\begin{cases}
			\frac{\clm}{2c^{m-1}_{l+1}} \tilde \alpha_{l,m,3} \quad \text{if } m>0 \\
			\frac{\clm}{2c^{m-1}_{l+1}} \tilde \alpha_{l,|m|,4} \quad \text{if } m\le0 
		\end{cases} \\
	\alpha_{l,m,4} &:=
		\begin{cases}
			\frac{\clm}{2c^{m+1}_{l+1}} \tilde \alpha_{l,m,4} \quad \text{if } m\ge0 \\
			\frac{\clm}{2c^{m+1}_{l+1}} \tilde \alpha_{l,|m|,3} \quad \text{if } m<0 
		\end{cases} \\
	\beta_{l,m,j} &:= (-1)^{j+1} \: i \: \alpha_{l,m,j}, \quad j = 1,2,3,4 \\
	\gamma_{l,m,1} &:= \frac{\clm}{c^{m}_{l-1}} \: \tilde \gamma_{l,m,1} \\
	\gamma_{l,m,2} &:= \frac{\clm}{c^{m}_{l+1}} \: \tilde \gamma_{l,m,2}.
}
and
\bseqn{
	\tilde \alpha_{l,m,1} &:= \frac{2l}{2l+1} \\
	\tilde \alpha_{l,m,2} &:= 
		\begin{cases}
			- \frac{l}{2(2l+1)} \quad \text{if } l - m \ge 2 \\
			\quad \quad 0 \quad \quad \text{otherwise}
		\end{cases} \\
	\tilde \alpha_{l,m,3} &:= - \frac{2(l-m+2)(l-m+1)}{(2l+1)(l+1)} \\
	\tilde \alpha_{l,m,4} &:= \frac{(l+m+2)(l+m+1)}{2(2l+1)(l+1)} \\
	\tilde \gamma_{l,m,1} &:= \begin{cases}
			\frac{l}{2l+1} \quad \text{if } l - m \ge 1 \\
			\quad 0 \quad \quad \text{otherwise}
		\end{cases} \\
	\tilde \gamma_{l,m,2} &:= \frac{(l-m+1)(l+m+1)}{(2l+1)(l+1)}.
}
\end{lemma}

\begin{proof}
	The recurrence relationship for the Jacobi polynomials satisfies \cite[18.9.1, 18.9.2]{DLMF} 
\bseqn{
	z P^{(m,m)}_{l-m}(z) = \tilde \gamma_{l,m,1} P^{(m,m)}_{l-m-1}(z) + \tilde \gamma_{l,m,2} P^{(m,m)}_{l-m+1}(z),
}
for $k \ge 0, \, m \in \Z$. Hence, the expression for multiplication of the spherical harmonic $\Ylm$ by $z$ is
\bseqn{
	z\,\Ylmxyz &= \clm \eimphi \rho(z)^{|m|} z P^{(|m|,|m|)}_{l-|m|}(z)  \\
		     &= \clm \eimphi \rho(z)^{|m|} \big[ \tilde \gamma_{l,m,1} P^{(|m|,|m|)}_{l-|m|-1}(z) + \tilde \gamma_{l,m,2} P^{(|m|,|m|)}_{l-|m|+1}(z) \big] \\
		     &= \gamma_{l,m,1} Y^{m}_{l-1}(x,y,z) + \gamma_{l,m,2} Y^{m}_{l+1}(x,y,z).
}

For multiplication by $x$ and $y$, we require some further relations for the complex exponential and the Jacobi polynomials. First, recall that
\bseqn{
	\cosphi \, \eimphi &= \frac{1}{2} (e^{i\varphi} + e^{-i\varphi}) \eimphi =  \frac{1}{2} (e^{i(m+1)\varphi} + e^{i(m-1)\varphi}) \\
	\sinphi \, \eimphi &= \frac{1}{2i} (e^{i\varphi} - e^{-i\varphi}) \eimphi =  \frac{-i}{2} (e^{i(m+1)\varphi} - e^{i(m-1)\varphi})
}
Finally, we can express a Jacobi polynomial $P^{(a,b)}_{l-m}(z)$ in terms of an ultraspherical polynomial $C^{(\lambda)}_{l-m}(z)$ \cite[18.7.2]{DLMF}:
\bseqn{
	{l! \: (2m)! \over (l+m)! \: m!} \: C^{(m+1/2)}_{l-m}(z) = P^{(m,m)}_{l-m}(z),
}
where the ultraspherical polynomials satisfy the relations \cite[18.9.7, 18.9.8]{DLMF}:
\bseqn{
	C^{(\lambda)}_n(z) &= {\lambda \over n + \lambda} \: \big[ C^{(\lambda+1)}_n(z) - C^{(\lambda+1)}_{n-2}(z) \big]  \\
	(1-z^2) \, C^{(\lambda)}_n(z) &= {1 \over 4(\lambda-1)(n+\lambda)} \: \big[ (n+2\lambda-2)(n+2\lambda-1) \: C^{(\lambda-1)}_n(z) \\
	&\quad \quad \quad \quad \quad \quad \quad \quad \quad \quad - (n+1)(n+2) \: C^{(\lambda-1)}_{n+2}(z) \big] ,
}
for $m \in \No$ where $\lambda > -\half$ is some parameter. Thus, combining these, we can write three-term recurrences for the Jacobi polynomials as:
\bseqn{
	P^{(m,m)}_{l-m}(z) &= \tilde \alpha_{l,m,4} P^{(m+1,m+1)}_{l-m}(z) + \tilde \alpha_{l,m,2} P^{(m+1,m+1)}_{l-m-2}(z) \\
	(1-z^2) \, P^{(m,m)}_{l-m}(z) &= \tilde \alpha_{l,m,3} P^{(m-1,m-1)}_{l-m+2}(z) + \tilde \alpha_{l,m,1} P^{(m-1,m-1)}_{l-m}(z),
}
for $l, m \in \No$ s.t. $0 \le m \le l$. Hence, the expressions for multiplication of the spherical harmonic $\Ylm$ by $x$ and $y$ is then:
\bseqn{
	x\,\Ylmxyz &= \clm \cosphi \: \eimphi \: \sintheta \: \rho(z)^{|m|} P^{(|m|,|m|)}_{l-|m|}(z) \\
	&= \half \clm (e^{i(m+1)\varphi} + e^{i(m-1)\varphi}) \rho(z)^{|m|+1} P^{(|m|,|m|)}_{l-|m|}(z) \\
	&= \half \clm e^{i(m+1)\varphi} \rho(z)^{|m|+1} \: \big[ \tilde \alpha_{l,m,4} P^{(|m|+1,|m|+1)}_{l-|m|}(z) + \tilde \alpha_{l,m,2} P^{(|m|+1,|m|+1)}_{l-|m|-2}(z) \big] \\
	&\quad \quad + \half \clm e^{i(m-1)\varphi} \rho(z)^{|m|-1} \: \big[ \tilde \alpha_{l,m,3} P^{(|m|-1,|m|-1)}_{l-|m|+2}(z) + \tilde \alpha_{l,m,1} P^{(|m|-1,|m|-1)}_{l-|m|}(z) \big] \\
	&= \alpha_{l,m,1} Y^{m-1}_{l-1}(x,y,z) +  \alpha_{l,m,2} Y^{m+1}_{l-1}(x,y,z) \\
	&\quad \quad + \alpha_{l,m,3} Y^{m-1}_{l+1}(x,y,z) + \alpha_{l,m,4} Y^{m+1}_{l+1}(x,y,z), \\
	y\,\Ylmxyz &= \clm \sinphi \: \eimphi \: \sintheta \: \rho(z)^{|m|} P^{(|m|,|m|)}_{l-|m|}(z) \\
	&= -\half i \: \clm (e^{i(m+1)\varphi} - e^{i(m-1)\varphi}) \: \rho(z)^{|m|+1} P^{(|m|,|m|)}_{l-|m|}(z) \\
	&= - i \: \big[\Alm Y^{m+1}_{l+1}(x,y,z) +  \Blm Y^{m+1}_{l-1}(x,y,z) \big] \\
	&\quad \quad \quad + i \, \big[ \Dlm Y^{m-1}_{l+1}(x,y,z) + \Elm Y^{m-1}_{l-1}(x,y,z) \big], \\
	&= i \: \Big\{ \alpha_{l,m,1} Y^{m-1}_{l-1}(x,y,z) - \alpha_{l,m,2} Y^{m+1}_{l-1}(x,y,z) \\
	&\quad \quad \quad + \alpha_{l,m,3} Y^{m-1}_{l+1}(x,y,z) - \alpha_{l,m,4} Y^{m+1}_{l+1}(x,y,z) \Big\}.
}

\end{proof}

These recurrences lead to Jacobi operators that correspond to multiplication by $x,y,z$. Define for $l \in \No$:
\bseqn{
	\SHvecl := 
		\begin{pmatrix}
			Y^{-l}_l \\
			\vdots \\
			Y^l_l
		\end{pmatrix} \in \C^{2l+1}, 
	\quad \quad 
	\SHvec := 
		\begin{pmatrix}
			\SHvec_0 \\
			\hline
			\SHvec_1 \\
			\hline
			\SHvec_2 \\
			\vdots \\
		\end{pmatrix}.
}
and let the Jacobi matrices $J^x, J^y, J^z$ be given by 
\bseqnnumber{
	J^x \SHvec = x \SHvec, \quad J^y \SHvec = y \SHvec, \quad J^z \SHvec = z \SHvec \label{eqn:jacobimatsdef}.
}
The Jacobi matrices act on the coefficients vector of a function's expansion in the spherical harmonic basis. For example, let the function $f(x,y,z) : \Omega \to \C$ be approximated by its expansion $f(x,y,z) = \SHvec(x,y,z)^\top \: \fvec$ up to some degree order $N$. Then $x f(x,y,z)$ is approximated by $\SHvec(x,y,z)^\top \: J^x \: \fvec$, i.e. $ J^x \: \fvec$ is the coefficients vector for the expansion of the function $(x,y,z) \mapsto x \: f(x,y,z)$ in the spherical harmonics basis.

An important property of the Jacobi matrices is that they are sparse -- specifically they are \textit{banded-block-banded matrices}.

\begin{definition}\label{def:bandedblockbanded}
	A block matrix $A$ with blocks $A_{i,j}$ has block-bandwidths $(L, U)$ if $A_{i,j} = 0$ for $-L \le j - i \le U$, and subblock-bandwidths $(\lambda, \mu)$ if all blocks are banded with bandwidths $(\lambda, \mu)$. A matrix where the block-bandwidths and subblock-bandwidths are small compared to the dimensions is referred to as a banded-block-banded matrix.
\end{definition}

Using \bsrefeqns{eqn:shrecx}{eqn:shrecz}, we have that the Jacobi matrices take the following block-tridiagonal form (i.e. have block-bandwidths $(1,1)$):
\bseqn{
	J_x &= 
		\begin{pmatrix}
			B_{x,0} & A_{x,0} & & & & \\
			C_{x,1} & B_{x,1} & A_{x,1} & & & \\
			& C_{x,2} & B_{x,2} & A_{x,2}  & & & \\
			& & C_{x,3} & \ddots & \ddots & \\
			& & & \ddots & \ddots & \ddots \\
		\end{pmatrix}, \\
	J_y &= 
		\begin{pmatrix}
			B_{y,0} & A_{y,0} & & & & \\
			C_{y,1} & B_{y,1} & A_{y,1} & & & \\
			& C_{y,2} & B_{y,2} & A_{y,2}  & & & \\
			& & C_{y,3} & \ddots & \ddots & \\
			& & & \ddots & \ddots & \ddots \\
		\end{pmatrix}, \\
	J_z &= 
		\begin{pmatrix}
			B_{z,0} & A_{z,0} & & & & \\
			C_{z,1} & B_{z,1} & A_{z,1} & & & \\
			& C_{z,2} & B_{z,2} & A_{z,2}  & & & \\
			& & C_{z,3} & \ddots & \ddots & \\
			& & & \ddots & \ddots & \ddots \\
		\end{pmatrix}.
}
$J_x$ has subblock-bandwidths $(2,2)$, where the blocks for $l \in \No$ are given by:
\bseqn{
	A_{x,l} &:= 
		\begin{pmatrix}
			\alpha_{l,-l,3} & 0 & \alpha_{l,-l,4} & & \\
			& \ddots & \ddots & \ddots & \\
			& & \alpha_{l,l,3} & 0 & \alpha_{l,l,4} \\
		\end{pmatrix} \in \R^{(2l+1)\times(2l+3)}, \\
	B_{x,l} &:= 0 \in \R^{(2l+1)\times(2l+1)} \\
	C_{x,l} &:= 
		\begin{pmatrix}
			\alpha_{l,-l,2} & & \\
			0 & \ddots & \\
			\alpha_{l,-l+2,1} & \ddots & \alpha_{l,l-2,2} \\
			& \ddots & 0 \\
			& & \alpha_{l,l,1}
		\end{pmatrix} \in \R^{(2l+1)\times(2l-1)} \quad (l \ne 0).
}
$J_y$ also has subblock-bandwidths $(2,2)$, where the blocks for $l \in \No$ are given by:
\bseqn{
	A_{y,l} &:= 
		\begin{pmatrix}
			\beta_{l,-l,3} & 0 & \beta_{l,-l,4} & & \\
			& \ddots & \ddots & \ddots & \\
			& & \beta_{l,l,3} & 0 & \beta_{l,l,4} \\
		\end{pmatrix} \in \C^{(2l+1)\times(2l+3)}, \\
	B_{y,l} &:= 0 \in \R^{(2l+1)\times(2l+1)} \\
	C_{y,l} &:= 
		\begin{pmatrix}
			\beta_{l,-l,2} & & \\
			0 & \ddots & \\
			\beta_{l,-l+2,1} & \ddots & \beta_{l,l-2,2} \\
			& \ddots & 0 \\
			& & \beta_{l,l,1}
		\end{pmatrix} \in \C^{(2l+1)\times(2l-1)} \quad (l \ne 0).
}
Finally, $J_z$ has subblock-bandwidths $(1,1)$, where the blocks for $l \in \No$ are given by:
\bseqn{
	A_{z,l} &:= 
		\begin{pmatrix}
			0 & \gamma_{l,-l,2} & 0 & & \\
			& \ddots & \ddots & \ddots & \\
			& & 0 &  \gamma_{l,-l,2} & 0 \\
		\end{pmatrix} \in \R^{(2l+1)\times(2l+3)}, \\
	B_{z,l} &:= 0 \in \R^{(2l+1)\times(2l+1)} \\
	C_{z,l} &:= 
		\begin{pmatrix}
			0 & & \\
			\gamma_{l,-l+1,1} & \ddots & \\
			0 & \ddots & 0 \\
			& \ddots & \gamma_{l,l-1,1} \\
			& & 0
		\end{pmatrix} \in \R^{(2l+1)\times(2l-1)} \quad (l \ne 0).
}


\section{Three-term recurrence relation for $\SHvec$}

Three-term recurrence relations for orthogonal polynomials are well established (e.g. \cite[18.9]{DLMF}, \cite{dunkl2014orthogonal}). In a similar vein, we can obtain a recurrence relation for the spherical harmonics by combining each system in (\ref{eqn:jacobimatsdef}).
\bseqn{
	\renewcommand\arraystretch{1.3}
	\begin{pmatrix}
		1 & & & \\
		B_0-G_0(x,y,z) & A_0 & & \\
		C_1 & B_1-G_1(x,y,z) & \quad A_1 \quad & \\
		& C_2 & B_2 - G_2(x,y,z)  & \ddots \\
		& & \ddots &\ddots
	\end{pmatrix}
	\SHvec(x,y,z)
	=
	\begin{pmatrix}
		Y_0 \\ 0 \\ 0 \\ 0 \\ \vdots
	\end{pmatrix},
}
where we note $Y_0^0(x,y,z) \equiv Y_0 := c_0^0 \: P_0^{(0,0)} \equiv \half {1 \over \sqrt{\pi}}$, and for each $l = 0,1,2\dots$,
\begin{align}
	A_l &:= 
		\begin{pmatrix}
			A_{x,l} \\
			A_{y,l} \\
			A_{z,l}
		\end{pmatrix} \in \C^{3(2l+1)\times(2l+3)}, \quad
	C_l := 
		\begin{pmatrix}
			C_{x,l} \\
			C_{y,l} \\
			C_{z,l}
		\end{pmatrix} \in \C^{3(2l+1)\times(2l-1)} \quad (n \ne 0), \label{eqn:clenshawmats1} \\
	B_l &:= 
		\begin{pmatrix}
			B_{x,l} \\
			B_{y,l} \\
			B_{z,l}
		\end{pmatrix} \in \C^{3(2l+1)\times(2l+1)}, \quad
	G_n(x,y) := 
		\begin{pmatrix}
			x\idmat{2l+1} \\
			y\idmat{2l+1} \\
			z\idmat{2l+1}
		\end{pmatrix}  \in \C^{3(2l+1)\times(2l+1)}. \label{eqn:clenshawmats2}
\end{align}
 
For each $l = 0,1,2\dots$ let $\Dlt$ be any matrix that is a left inverse of $A_l$, i.e. such that $\Dlt A_l = \idmat{2l+3}$. Multiplying our system by the preconditioner matrix that is given by the block diagonal matrix of the $\Dlt$'s, we obtain a lower triangular system \cite[p78]{dunkl2014orthogonal}, which can be expanded to obtain the recurrence:
\bseqn{
	\begin{cases}
		\SHvec_{-1}(x,y,z) := 0 \\
		\SHvec_{0}(x,y,z) := Y_0 \\
		\SHvec_{l+1}(x,y,z) = -\Dlt (B_l-G_l(x,y,z)) \SHvec_l(x,y,z) - \Dlt C_l  \,\SHvec_{l-1}(x,y,z), \quad l = 0,1,2,\dots.
	\end{cases}
}

Since the above holds for any $\Dlt$ that is a left inverse of $A_l$, we are free to choose the $\Dlt$ matrices in the following way. For $l \in \N$, we set
\bseqnnumber{
	\Dlt = 
		\begin{pmatrix}
			\hat{A}^{x,y}_l & \zeromat{(2l+3)\times(2l+1)}
		\end{pmatrix} \in \R^{(2l+3)\times3(2l+1)} \label{eqn:Dltdef}
}
where $\zeromat{(2l+3)\times(2l+1)}$ the zero matrix in $\R^{(2l+3)\times(2l+1)}$, and $\hat{A}^{x,y}_l \in \R^{(2l+3)\times2(2l+1)}$ is the left inverse of the matrix $\begin{pmatrix} A^x_l \\ A^y_l \end{pmatrix}$, given by
\bseqn{
	\hat{A}^{x,y}_l = 
		\begin{pmatrix}
			\frac{1}{2\alpha_{l,-l,3}} & 0 & \hdots & 0 & \frac{1}{2\beta_{l,-l,3}} & 0 & \hdots & 0 \\
			& \ddots & & & & \ddots & & \\
			& & \ddots & & & & \ddots & \\
			& & & \frac{1}{2\alpha_{l,l,3}} & 0 & \hdots & 0 & \frac{1}{2\beta_{l,-l,3}} \\
			0 & \hdots & \frac{1}{2\alpha_{l,l-1,4}} & 0 & \hdots & 0 & \frac{1}{2\beta_{l,l-1,4}} & 0 \\
			0 & \hdots & 0 & \frac{1}{2\alpha_{l,l,4}} & 0 & \hdots & 0 & \frac{1}{2\beta_{l,l,4}}
		\end{pmatrix}.
}
For $l = 0$ we set
\bseqnnumber{
	D^T_0 = 
		\begin{pmatrix}
			\frac{1}{2\alpha_{0,0,3}} & \frac{1}{2\beta_{0,0,3}} & 0 \\
			0 & 0 & \frac{1}{\gamma_{0,0,2}} \\
			\frac{1}{2\alpha_{0,0,4}}&  \frac{1}{2\beta_{0,0,4}} & 0 
		\end{pmatrix}. \label{eqn:Dzerotdef}
}

It will be useful for us to give a formal name for these coefficient matrices above for a family of multidimensional orthogonal polynomials.
\begin{definition}\label{def:clenshawmats}
	The matrices $-\Dlt (B_l-G_l(x,y,z))$, $\Dlt C_l$ for $l \in \No$ defined via \bsrefeqns{eqn:clenshawmats1}{eqn:Dzerotdef} are called the \textbf{recurrence coefficient matrices} for a given family of multidimensional orthogonal polynomials.
\end{definition}

%
%\subsection{Laplacian operator}
%
%The spherical harmonics are named as such because they are indeed harmonic functions -- that is, they satisfy $\nabla^2 \Ylm = \lambda \Ylm$ for some eigenvalue $\lambda$. It can be shown that in fact, for any $l \in \No$, $-l \le m \le l$, \bstodo{cite}
%\bseqn{
%	\nabla^2 \Ylm = - l (l+1) \Ylm.
%}
%This allows us to write down a sparse (in fact, diagonal) matrix operator for the Laplacian. Recall that a function $f(x,y,z)$ defined on the unit sphere $\Omega$ is approximated by its expansion $\SHvec^\top \fvec$ for some coefficients vector $\fvec$ up to degree order $N \in \N$. Then the function $(x,y,z) \mapsto \nabla^2 f(x,y,z)$ is approximated by $\SHvec^\top \Delta \fvec$ where $\Delta$ is the matrix operator is then simply given by
%\bseqn{
%	\Delta := 
%		\begin{pmatrix}
%			\Delta_0 & & & \\
%			& \Delta_1 & & \\
%			& & \ddots & \\
%			& & & \Delta_N
%		\end{pmatrix}, \quad
%	\Delta_l := - l (l+1) \idmat{2l+1} \in \R^{(2l+1)\times(2l+1)}.
%}


\section{Computational aspects}

Once again, let $f(x,y,z)$ be a function on the unit sphere $\Omega$ be approximated by its expansion 
\bseqn{
	f(x,y,z) \approx \SHvec(x,y,z)^\top \fvec = \sum^N_{l=0} \SHvecl(x,y,z)^\top \fvec_l =  \sum^N_{l=0}  \sum^l_{m=-l} f_{l,m} \: \Ylmxyz,
}
where $\SHvecl (x,y,z), \fvec_l \in \C^{2l+1}$ for each $l \in \{0,\dots,N\}$, for some coefficients vector $\fvec = (f_{l,m})$ up to degree order $N \in \N$.


\subsection{Obtaining coefficients}

\bstodoinline{obtaining coeffs/ transform}
In spectral space, we wish to work only with vectors of coefficients for the expansion of a function, to which we can apply operator matrices to that represent differential or other operations. Naturally, we of course need a way to obtain the coefficients $f_{l,m}$. The coefficients can be calculated via the integral
\bseqn{
	f_{l,m} = \int_\Omega f(\costheta \sinphi, \sintheta \sinphi, \cosphi) \: \Ylmfull^* \: \sinphi \: \D \varphi \: \D \theta
}
using the orthonormality of the spherical harmonics. Methods to calculate these coefficients exist, known as spectral transforms, and are well established for the spherical harmonics (see e.g. \cite{mohlenkamp1999fast, suda2002fast}).


\subsection{Function evaluation}\label{subsubsection:clenshaw}

We can use the Clenshaw algorithm to evaluate this function at a given point $(x,y,z)$ on $\Omega$ \cite{press2007numerical}. The \textit{Clenshaw algorithm} is then as follows:
\bseqn{
	\quad &\text{1) } \text{Set } \vec{\xi}_{N+2} = \bold{0}, \: \vec{\xi}_{N+2} = \bold{0}. \\
	\quad &\text{2) } \text{For } n = N:-1:0 \\
	\quad & \quad \quad \quad \text{set } \vec{\xi}_{n}^T = \fvec_n^T - \vec{\xi}_{n+1}^T D^T_n (B_n - G_n(x,y,z)) -  \vec{\xi}_{n+2}^T D^T_{n+1}C_{n+1} \\
	\quad &\text{3) } \text{Output: } f(x,y,z) \approx \vec{\xi}_{0}^T \SHvec_0(x,y,z) \equiv \xi_0 Y_0.
}


\subsection{Obtaining operator matrices for variable coefficients}

The Clenshaw algorithm presented in \bsrefsection{subsubsection:clenshaw} can also be used with the Jacobi matrices replacing the point $(x,y,z)$, to yield an operator matrix. 

Let's explain what we mean. Suppose $v : \Omega \to \C$ is a function, and we encounter the problem of finding the coefficients of the expansion for $v(x,y,z) f(x,y,z)$. We wish to therefore find an operator $V$ for $v$ so that
\bseqn{
	v(x,y,z) f(x,y,z) = v(x,y,z) \fvec^\top \SHvec(x,y,z) = (V \; \fvec)^\top \SHvec(x,y,z),
}
i.e. $V \; \fvec$ is the coefficients vector for the expansion of the function $(x,y,z) \mapsto v(x,y,z) f(x,y,z)$ in the spherical harmonic basis.

Let $\vec{v}$ be the coefficients of the expansion of $v$ up to order $N$. The operator $V$ would then be the result of the following \textit{operator Clenshaw algorithm}:
\bseqn{
	\quad &\text{1) } \text{Set } \vec{\xi}_{N+2} = \bold{0}, \: \vec{\xi}_{N+2} = \bold{0}. \\
	\quad &\text{2) } \text{For } n = N:-1:0 \\
	\quad & \quad \quad \quad \text{set } \vec{\xi}_{n}^T = \vec{v}_n^T - \vec{\xi}_{n+1}^T D^T_n (B_n - G_n(J_x,J_y,J_z)) -  \vec{\xi}_{n+2}^T D^T_{n+1}C_{n+1} \\
	\quad &\text{3) } \text{Output: } f(x,y,z) \approx \vec{\xi}_{0}^T \SHvec_0(x,y,z) \equiv \xi_0 Y_0
}
where at each iteration, $\vec{\xi}_n$ is a vector of matrices (note that we are abusing notation here a bit, however it is the simplest way to present the algorithm without introducing yet more matrices!).





%%%
\section{Vector spherical harmonics as orthogonal vectors in three variables}


Since the spherical harmonics are a basis for the surface of the sphere, and the tangent space of the sphere is spanned by the gradient and perpendicular gradient of a scalar function, we have that the gradients and perpendicular gradients of the spherical harmonics 
\bseqnnumber{
	\gradYlm, \quad \gradpYlm := \rvec \times \gradYlm, \label{eqn:VSHs}
}
span the tangent space. Here, $\rvec$ is simply the outward unit normal vector to the surface of the sphere at the point $(x,y,z)$. Importantly, the set $\{\gradYlm, \gradpYlm\}$ form a complete and orthogonal basis for vector valued functions in the tangent space of the sphere and are known as \textit{vector spherical harmonics (VSHs)} \cite{barrera1985vector}. Vector spherical harmonics have been widely used in electrostatics (e.g. \cite{barrera1985vector}), electrodynamics (e.g. \cite{carrascal1991vector}), and of course fluid dynamics including weather and climate modelling (e.g. \cite{moses1974use, fengler2005nonlinear, swarztrauber1996spectral}). Other definitions for VSHs are used (e.g. \cite{hill1954theory}), however it is convenient for deriving explicit sparse relations and operators to use the one described here.

A simple calculation shows that such orthogonal vectors must still have block-tridiagonal Jacobi operators, as multiplication by $x, y$, or $z$ remains inside the ideal. We will determine the coefficients of these Jacobi operators, as well as other important operators needed -- however first we note a useful property of the VSHs that is a result of the definition used.


\subsection{Jacobi matrices} %{Spin-1 tensor spherical harmonics}

\bstodoinline{cite C-G coeffs, spin-1 tensor harmonics, and the combination expression in \label{eqn:VSHsalt}}
\bstodoinline{get better reference than that Winter 2017 physics document}

We start as before for the scalar case by finding $x \,\gradYlm (x,y,z)$, $x \,\gradpYlm (x,y,z)$ etc. in terms of $\gradY^{m'}_{l'} (x,y,z)$, $\gradpY^{m'}_{l'} (x,y,z)$. To this end, we use the helpful property that the vector spherical harmonics as defined in \bsrefeqn{eqn:VSHs} can be expressed in terms of \textit{spin-1 tensor spherical harmonics}, which in turn can each be expressed as a vector-weighted sum of spherical harmonics \cite{khersonskii1988quantum}.

We start by defining what we mean by a spin-1 tensor spherical harmonic. In general, the tensor spherical harmonic is given by, for $2l, \, j, \, 2s \in \No$, \cite{}
\bseqn{
	\curlyy^{j,s}_{l,m}(x,y,z) = \sum_{m_s=-s}^s \langle j \quad m-m_s \; ; \; s \quad m_s \; | \; l \quad m \rangle \, Y^{m-m_s}_j (x,y,z) \, \vec{\chi}_{s, m_s},
}
where $\vec{\chi}_{s, m_s}$ are the simultaneous eigenstates of the spin operators $\bold{S}^2$ and $S_z$, and where $\langle j \quad m-m_s \; ; \; s \quad m_s \; | \; l \quad m \rangle$ is a Clebsch--Gordan coefficient \cite{} . We note that a property of the Clebsch--Gordan coefficients means that they vanish unless $|j - s| \le l \le j + s$ \cite{}. We further note that there are simple calculable expressions for the Clebsch--Gordan coefficients when the spin $s=1$ \cite{}. 

To simplify the notation, for spin $s=1$, we define
\bseqnnumber{
	\cgcoeff^{L, m_s}_{l, m} := \, \langle L \quad m-m_s \; ; \; 1 \quad m_s \; | \; l \quad m \rangle. \label{eqn:cgcoeffdef}
}
Thus we have that the three spin-1 tensor spherical harmonics are given by
\bseqn{
	\curlyy^{l \pm1,1}_{l,m}(x,y,z) &= \sum_{m_s=-1}^1 \cgcoeff^{l\pm1, m_s}_{l, m} \, Y^{m-m_s}_{l \pm 1} (x,y,z) \, \chivec, \\
	\curlyy^{l,1}_{l,m}(x,y,z) &= \sum_{m_s=-1}^1 \cgcoeff^{l, m_s}_{l, m} \, Y^{m-m_s}_l (x,y,z) \, \chivec.
}

Here, the vectors $\chivec$ are the orthonormal eigenvectors of the matrix
\bseqn{
	S_3 = \begin{pmatrix} 0 & -i & 0 \\ i & 0 & 0 \\ 0 & 0 & 0 \end{pmatrix},
}
and so are given as
\bseqn{
	\vec{\chi}_{1, \pm 1} = \frac{1}{\sqrt{2}} \begin{pmatrix} \mp 1 \\ -i \\ 0 \end{pmatrix}, \quad \vec{\chi}_{1,0} = \begin{pmatrix} 0 \\ 0 \\ 1 \end{pmatrix}.
}
Then, for any $l \in \No$, $m \in \Z$ s.t. $0 \le |m| \le l$ we have that
\bseqnnumber{
	\gradYlm &= \mu_{l,-1} \, \curlyy^{l-1,1}_{l,m} + \mu_{l,1} \curlyy^{l+1,1}_{l,m}, \quad \gradpYlm = \mu_{l,0} \, \curlyy^{l,1}_{l,m}, \label{eqn:VSHsalt}
}
where
\bseqnnumber{
	\mu_{l,-1} &:= (l+1) \, \Big(\frac{l}{2l+1}\Big)^\half, \quad
	\mu_{l,0} := i \, \big(l(l+1)\big)^\half, \quad 
	\mu_{l,1} := l \, \Big(\frac{l+1}{2l+1}\Big)^\half. \label{eqn:spintensorvshcoeffsdef}
}

The expressions for the VSHs as given in \bsrefeqn{eqn:VSHsalt} allow us to be able to find the coefficients for our desired expressions for $x \gradYlm$, $y \gradYlm$ and $z \gradYlm$. 
\begin{lemma}\label{lemma:VSHrecurrences}
	For $l \in \No$, $-l \le m \le l$ the vector spherical harmonics satisfy the relationships:
\bseqn{
	x \gradYlm &= A_{l,m,1} \gradY^{m-1}_{l-1} + A_{l,m,2} \gradY^{m+1}_{l-1} + A_{l,m,3} \gradY^{m-1}_{l+1} + A_{l,m,4} \gradY^{m+1}_{l+1} \\
& \quad \quad \quad + A_{l,m,5} \gradpY^{m-1}_{l} + A_{l,m,6} \gradpY^{m+1}_{l}, \\
	x \gradpYlm &= A_{l,m,1} \gradpY^{m-1}_{l-1} + A_{l,m,2} \gradpY^{m+1}_{l-1} + A_{l,m,3} \gradpY^{m-1}_{l+1} + A_{l,m,4} \gradpY^{m+1}_{l+1} \\
& \quad \quad \quad - A_{l,m,5} \gradY^{m-1}_{l} - A_{l,m,6} \gradY^{m+1}_{l}, \\
	y \gradYlm &= B_{l,m,1} \gradY^{m-1}_{l-1} + B_{l,m,2} \gradY^{m+1}_{l-1} + B_{l,m,3} \gradY^{m-1}_{l+1} + B_{l,m,4} \gradY^{m+1}_{l+1} \\
& \quad \quad \quad + B_{l,m,5} \gradpY^{m-1}_{l} + B_{l,m,6} \gradpY^{m+1}_{l}, \\
	y \gradpYlm &= B_{l,m,1} \gradpY^{m-1}_{l-1} + B_{l,m,2} \gradpY^{m+1}_{l-1} + B_{l,m,3} \gradpY^{m-1}_{l+1} + B_{l,m,4} \gradpY^{m+1}_{l+1} \\
& \quad \quad \quad - B_{l,m,5} \gradY^{m-1}_{l} - B_{l,m,6} \gradY^{m+1}_{l}, \\
	z \gradYlm &= \Gamma_{l,m,1} \gradY^{m}_{l-1} + \Gamma_{l,m,2} \gradY^{m}_{l+1} + \Gamma_{l,m,3} \gradpY^{m}_{l}, \\
	z \gradpYlm &= \Gamma_{l,m,1} \gradpY^{m}_{l-1} + \Gamma_{l,m,2} \gradpY^{m}_{l+1} - \Gamma_{l,m,3} \gradY^{m}_{l}
}
%\bseqn{
%	x \gradYlm &= A_{l,m,1} \gradY^{m-1}_{l-1} + A_{l,m,2} \gradY^{m+1}_{l-1} + A_{l,m,5} \gradY^{m-1}_{l+1} + A_{l,m,6} \gradY^{m+1}_{l+1} \\
%& \quad \quad \quad + A_{l,m,3}^{*} \gradpY^{m-1}_{l} + A_{l,m,4}^{*} \gradpY^{m+1}_{l}, \\
%	x \gradpYlm &= A_{l,m,1}^{*} \gradpY^{m-1}_{l-1} + A_{l,m,2}^{*} \gradpY^{m+1}_{l-1} + A_{l,m,5}^{*} \gradpY^{m-1}_{l+1} + A_{l,m,6}^{*} \gradpY^{m+1}_{l+1} \\
%	& \quad \quad \quad + A_{l,m,3} \gradY^{m+1}_{l} + A_{l,m,4} \gradY^{m-1}_{l}, \\
%	y \gradYlm &= B_{l,m,1} \gradY^{m-1}_{l-1} + B_{l,m,2} \gradY^{m+1}_{l-1} + B_{l,m,5} \gradY^{m-1}_{l+1} + B_{l,m,6} \gradY^{m+1}_{l+1} \\
%& \quad \quad \quad + B_{l,m,3}^{*} \gradpY^{m-1}_{l} + B_{l,m,4}^{*} \gradpY^{m+1}_{l}, \\
%	y \gradpYlm &= B_{l,m,1}^{*} \gradpY^{m-1}_{l-1} + B_{l,m,2}^{*} \gradpY^{m+1}_{l-1} + B_{l,m,5}^{*} \gradpY^{m-1}_{l+1} + B_{l,m,6}^{*} \gradpY^{m+1}_{l+1} \\
%	& \quad \quad \quad + B_{l,m,3} \gradY^{m+1}_{l} + B_{l,m,4} \gradY^{m-1}_{l}, \\
%	z \gradYlm &= \Gamma_{l,m,1} \gradY^{m}_{l-1} + \Gamma_{l,m,3} \gradY^{m}_{l+1} + \Gamma_{l,m,2}^* \gradpY^{m}_{l}, \\
%	z \gradpYlm &= \Gamma_{l,m,1}^* \gradpY^{m}_{l-1} + \Gamma_{l,m,3}^* \gradpY^{m}_{l+1} + \Gamma_{l,m,2} \gradY^{m}_{l}
%}
%where $*$ denotes the complex conjugate, and where, for any valid $m_s$ value,
where, for any valid $m_s$ value,
\bseqn{
	A_{l,m,1} &:= \frac{\mu_{l,-1}}{\mu_{l-1,-1}} \frac{\cgcoeff^{l-1,m_s}_{l,m}}{\cgcoeff^{l-2,m_s}_{l-1,m-1}} \alpha_{l-1,m-m_s,1}, \\
	A_{l,m,2} &:= \frac{\mu_{l,-1}}{\mu_{l-1,-1}} \frac{\cgcoeff^{l-1,m_s}_{l,m}}{\cgcoeff^{l-2,m_s}_{l-1,m+1}} \alpha_{l-1,m-m_s,2}, \\
	A_{l,m,3} &:= \frac{\mu_{l,1}}{\mu_{l+1,1}} \frac{\cgcoeff^{l+1,m_s}_{l,m}}{\cgcoeff^{l+2,m_s}_{l+1,m-1}} \alpha_{l+1,m-m_s,3}, \\
	A_{l,m,4} &:= \frac{\mu_{l,1}}{\mu_{l+1,1}} \frac{\cgcoeff^{l+1,m_s}_{l,m}}{\cgcoeff^{l+2,m_s}_{l+1,m+1}} \alpha_{l+1,m-m_s,4}, \\
	A_{l,m,5} &:= \frac{1}{\mu_{l,0} \, \cgcoeff^{l,m_s}_{l, m-1}} \, \Big[ \cgcoeff^{l-1,m_s}_{l,m} \, \mu_{l,-1} \, \alpha_{l-1,m-m_s,3} + \cgcoeff^{l+1,m_s}_{l,m} \, \mu_{l,1} \, \alpha_{l-1,m-m_s,1} \\
	& \quad \quad \quad \quad \quad \quad \quad - A_{l,m,3} \, \mu_{l+1,-1} \, \cgcoeff^{l,m_s}_{l+1,m-1} - A_{l,m,1} \, \mu_{l-1,1} \, \cgcoeff^{l,m_s}_{l-1,m-1} \Big], \\	
	A_{l,m,6} &:= \frac{1}{\mu_{l,0} \, \cgcoeff^{l,m_s}_{l, m+1}} \, \Big[ \cgcoeff^{l-1,m_s}_{l,m} \, \mu_{l,-1} \, \alpha_{l-1,m-m_s,4} + \cgcoeff^{l+1,m_s}_{l,m} \, \mu_{l,1} \, \alpha_{l-1,m-m_s,2} \\
	& \quad \quad \quad \quad \quad \quad \quad - A_{l,m,4} \, \mu_{l+1,-1} \, \cgcoeff^{l,m_s}_{l+1,m+1} - A_{l,m,2} \, \mu_{l-1,1} \, \cgcoeff^{l,m_s}_{l-1,m+1} \Big], \\
	B_{l,m,j} &:= i (-1)^{j+1} A_{l,m,j} \quad \text{for } j = 1,\dots,6, \\
	\Gamma_{l,m,1} &:= \frac{\mu_{l,-1}}{\mu_{l-1,-1}} \frac{\cgcoeff^{l-1,m_s}_{l,m}}{\cgcoeff^{l-2,m_s}_{l-1,m}} \gamma_{l-1,m-m_s,1}, \\
	\Gamma_{l,m,2} &:= \frac{\mu_{l,1}}{\mu_{l+1,1}} \frac{\cgcoeff^{l+1,m_s}_{l,m}}{\cgcoeff^{l+2,m_s}_{l+1,m}} \gamma_{l+1,m-m_s,2}, \\
	\Gamma_{l,m,3} &:= \frac{1}{\mu_{l,0} \, \cgcoeff^{l,m_s}_{l, m}} \, \Big[ \cgcoeff^{l-1,m_s}_{l,m} \, \mu_{l,-1} \, \gamma_{l-1,m-m_s,2} + \cgcoeff^{l+1,m_s}_{l,m} \, \mu_{l,1} \, \gamma_{l+1,m-m_s,1} \\
	& \quad \quad \quad \quad \quad \quad \quad - \Gamma_{l,m,3} \, \mu_{l+1,-1} \, \cgcoeff^{l,m_s}_{l+1,m} - \Gamma_{l,m,1} \, \mu_{l-1,1} \, \cgcoeff^{l,m_s}_{l-1,1} \Big],
}
and where $\cgcoeff^{L,m_s}_{l,m}$, $\mu_{l,k}$ are defined in \bsrefeqn{eqn:cgcoeffdef} and \bsrefeqn{eqn:spintensorvshcoeffsdef} respectively.
\end{lemma}

\remark It is the case that these coefficients are indeed the same for each $l,m$ pair despite appearing to depend on the value of $m_s$; we need only use any valid $m_s$ value for each expression. By \enquote{valid}, we mean the Clebsch--Gordan coefficients do not vanish for that $m_s$ value when used.

\begin{proof}[Proof of \bsreflemma{lemma:VSHrecurrences}]

\bstodoinline{Do the derivation of these rec coeffs, to have as the proof (and check they are correct!). Need to account for l=1 case.}

Fix $l \in \N, m\in\{-l,\dots,l\}$, and define $Y_{-1}^m := 0$ for any $m \in \Z$. We proceed first with the case for multiplication by $z$. Using the definitions given for $\Gamma_{l,m,1}, \Gamma_{l,m,2}, \Gamma_{l,m,3}$ in the Lemma, we have that
\bseqn{
	&\Gamma_{l,m,1} \gradY^{m}_{l-1} + \Gamma_{l,m,3} \gradY^{m}_{l+1} + \Gamma_{l,m,2}^* \gradpY^{m}_{l} \\
	&\quad = \sum_{m_s=-1}^1 \vec{\chi}_{1, m_s} \: \Big\{ \Gamma_{l,m,1} \mu_{l-1,-1} \cgcoeff^{l-2, m_s}_{l-1, m} Y^{m-m_s}_{l-2} + \Gamma_{l,m,1} \mu_{l-1,1} \cgcoeff^{l, m_s}_{l-1, m} Y^{m-m_s}_{l} \\
	&\quad \quad \quad \quad \quad \quad \quad \quad + \Gamma_{l,m,3} \mu_{l+1,-1} \cgcoeff^{l, m_s}_{l+1, m} Y^{m-m_s}_{l} + \Gamma_{l,m,3} \mu_{l+1,1} \cgcoeff^{l+2, m_s}_{l+1, m} Y^{m-m_s}_{l+2} \\
	&\quad \quad \quad \quad \quad \quad \quad \quad + \Gamma_{l,m,2} \mu_{l,0} \cgcoeff^{l, m_s}_{l, m} Y^{m-m_s}_{l} \Big\} \\
	&\quad = \sum_{m_s=-1}^1 \vec{\chi}_{1, m_s} \: \Big\{ Y^{m-m_s}_{l-2} \Gamma_{l,m,1} \mu_{l-1,-1} \cgcoeff^{l-2, m_s}_{l-1, m} + Y^{m-m_s}_{l+2} \Gamma_{l,m,3} \mu_{l+1,1} \cgcoeff^{l+2, m_s}_{l+1, m} \\
	&\quad \quad \quad \quad \quad \quad \quad \quad + Y^{m-m_s}_{l} \Big[  \Gamma_{l,m,1} \mu_{l-1,1} \cgcoeff^{l, m_s}_{l-1, m} + \Gamma_{l,m,2} \mu_{l,0} \cgcoeff^{l, m_s}_{l, m} +  \Gamma_{l,m,3} \mu_{l+1,-1} \cgcoeff^{l, m_s}_{l+1, m} \Big] \Big\} \\
	&\quad = \sum_{m_s=-1}^1 \vec{\chi}_{1, m_s} \: \Big\{ \cgcoeff^{l-1, m_s}_{l, m}  \mu_{l,-1} \Big[ \gamma_{l-1,m-m_s,1} \: Y^{m-m_s}_{l-2} + \gamma_{l-1,m-m_s,2} \: Y^{m-m_s}_{l} \Big] \\
	&\quad \quad \quad \quad \quad \quad \quad \quad + \cgcoeff^{l+1, m_s}_{l, m}  \mu_{l,1} \Big[ \gamma_{l+1,m-m_s,1} \: Y^{m-m_s}_{l} + \gamma_{l+1,m-m_s,2} \: Y^{m-m_s}_{l+2} \Big] \Big\} \\
	&\quad = \sum_{m_s=-1}^1 \vec{\chi}_{1, m_s} \: z \: \Big\{ \cgcoeff^{l, m_s}_{l-1, m} \mu_{l,-1} Y^{m-m_s}_{l-1} + \cgcoeff^{l, m_s}_{l+1, m} \mu_{l,1} Y^{m-m_s}_{l+1} \Big\} \\
	&\quad = z \gradYlm,
}
demonstrating that the expression for $z \gradYlm(x,y,z)$ holds.

Firstly, reiterating the previous remark, the ratios of the CG coeffs are equal for each valid $m_s$ value.

Now, we compare coeffs and we are done.

\end{proof}


%\begin{align}
%x \,\gradYlm 
%&= x \, \blmone \, \curlyy^{l-1,1}_{l,m} + x \, \blone \curlyy^{l+1,1}_{l,m} \nonumber
%\\
%&= \sum_{m_s=-1}^{1} \chivec \Big[ \blmone \, \cgcoeff^{l-1,m_s}_{l,m} \big\{ A_{l-1,m-m_s} \, Y^{m-m_s+1}_{l} + B_{l-1,m-m_s} \, Y^{m-m_s+1}_{l-2} \nonumber \\ 
%& \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad + D_{l-1,m-m_s} \, Y^{m-m_s-1}_{l} + E_{l-1,m-m_s} \, Y^{m-m_s-1}_{l-2} \big\} \nonumber \\
%& \quad \quad \quad \quad \quad \quad \quad + \blone \, \cgcoeff^{l+1,m_s}_{l,m} \big\{ A_{l+1,m-m_s} \, Y^{m-m_s+1}_{l+2} + B_{l+1,m-m_s} \, Y^{m-m_s+1}_{l} \nonumber \\ 
%& \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad + D_{l+1,m-m_s} \, Y^{m-m_s-1}_{l+2} + E_{l+1,m-m_s} \, Y^{m-m_s-1}_{l} \big\} \Big]
%\end{align}
%\begin{align}
%\implies x \,\gradYlm &= \alm \gradY^{m+1}_{l+1} + \blm \gradY^{m+1}_{l-1} + \dlm \gradY^{m-1}_{l+1} + \elm \gradY^{m-1}_{l-1} \nonumber \\
%& \quad \quad \quad + \hlm \gradpY^{m+1}_{l} + \jlm \gradpY^{m-1}_{l},
%\end{align}
%where, for any valid $m_s$ value,
%\begin{align}
%\alm &:= \frac{\blone}{\beta_{l+1,1}} \frac{\cgcoeff^{l+1,m_s}_{l,m}}{\cgcoeff^{l+2,m_s}_{l+1,m+1}} A_{l+1,m-m_s}, \\
%\blm &:= \frac{\blmone}{\beta_{l-1,-1}} \frac{\cgcoeff^{l-1,m_s}_{l,m}}{\cgcoeff^{l-2,m_s}_{l-1,m+1}} B_{l-1,m-m_s}, \\
%\dlm &:= \frac{\blone}{\beta_{l+1,1}} \frac{\cgcoeff^{l+1,m_s}_{l,m}}{\cgcoeff^{l+2,m_s}_{l+1,m-1}} D_{l+1,m-m_s}, \\
%\elm &:= \frac{\blmone}{\beta_{l-1,-1}} \frac{\cgcoeff^{l-1,m_s}_{l,m}}{\cgcoeff^{l-2,m_s}_{l-1,m-1}} E_{l-1,m-m_s}, \\
%\hlm &:= \frac{1}{\blzero \, \cgcoeff^{l,m_s}_{l, m+1}} \, \Big[ \cgcoeff^{l-1,m_s}_{l,m} \, \blmone \, A_{l-1,m-m_s} + \cgcoeff^{l+1,m_s}_{l,m} \, \blone \, B_{l+1,m-m_s} \nonumber \\
%& \quad \quad \quad \quad \quad \quad \quad - \alm \, \beta_{l+1,-1} \, \cgcoeff^{l,m_s}_{l+1,m+1} - \blm \, \beta_{l-1,1} \, \cgcoeff^{l,m_s}_{l-1,m+1} \Big], \\
%\jlm &:= \frac{1}{\blzero \, \cgcoeff^{l,m_s}_{l, m-1}} \, \Big[ \cgcoeff^{l-1,m_s}_{l,m} \, \blmone \, D_{l-1,m-m_s} + \cgcoeff^{l+1,m_s}_{l,m} \, \blone \, E_{l+1,m-m_s} \nonumber \\
%& \quad \quad \quad \quad \quad \quad \quad - \dlm \, \beta_{l+1,-1} \, \cgcoeff^{l,m_s}_{l+1,m-1} - \elm \, \beta_{l-1,1} \, \cgcoeff^{l,m_s}_{l-1,m-1} \Big].
%\end{align}
%
%Note that (it can be shown) these are constants for each $l,m$ pair despite appearing to depend on the value of $m_s$; we need only use any valid $m_s$ value for each expression. By ``valid'', we mean the Clebsch--Gordan coefficients do not vanish for that $m_s$ value when used. 
%
%Similarly, we have that
%\begin{align}
%y \,\gradYlm &= i \, \Big[ -\alm \gradY^{m+1}_{l+1} - \blm \gradY^{m+1}_{l-1} + \dlm \gradY^{m-1}_{l+1} + \elm \gradY^{m-1}_{l-1} \nonumber \\
%& \quad \quad \quad - \hlm \gradpY^{m+1}_{l} + \jlm \gradpY^{m-1}_{l} \Big].
%\end{align}
%
%Further, we also have that
%\begin{align}
%z \,\gradYlm 
%&= z \, \blzero \, \curlyy^{l,1}_{l,m} \nonumber
%\\
%&= \sum_{m_s=-1}^{1} \chivec \Big[ \blmone \, \cgcoeff^{l-1,m_s}_{l,m} \big\{ F_{l-1,m-m_s} \, Y^{m-m_s}_{l} + G_{l-1,m-m_s} \, Y^{m-m_s}_{l-2} \big\} \nonumber \\ 
%& \quad \quad \quad \quad \quad \quad \quad + \blone \, \cgcoeff^{l+1,m_s}_{l,m} \big\{ F_{l+1,m-m_s} \, Y^{m-m_s}_{l+2} + G_{l+1,m-m_s} \, Y^{m-m_s}_{l} \big\} \Big]
%\end{align}
%\begin{align}
%\implies z \,\gradYlm &= \flm \gradY^{m}_{l+1} + \glm \gradY^{m}_{l-1} + \klm \gradpY^{m}_{l},
%\end{align}
%where, for any valid $m_s$ value,
%\begin{align}
%\flm &:= \frac{\blone}{\beta_{l+1,1}} \frac{\cgcoeff^{l+1,m_s}_{l,m}}{\cgcoeff^{l+2,m_s}_{l+1,m+1}} F_{l+1,m-m_s}, \\
%\glm &:= \frac{\blmone}{\beta_{l-1,-1}} \frac{\cgcoeff^{l-1,m_s}_{l,m}}{\cgcoeff^{l-2,m_s}_{l-1,m+1}} G_{l-1,m-m_s}, \\
%\klm &:= \frac{1}{\blzero \, \cgcoeff^{l,m_s}_{l, m}} \, \Big[ \cgcoeff^{l-1,m_s}_{l,m} \, \blmone \, F_{l-1,m-m_s} + \cgcoeff^{l+1,m_s}_{l,m} \, \blone \, G_{l+1,m-m_s}  \nonumber \\
%& \quad \quad \quad \quad \quad \quad \quad - \flm \, \beta_{l+1,-1} \, \cgcoeff^{l,m_s}_{l+1,m} - \glm \, \beta_{l-1,1} \, \cgcoeff^{l,m_s}_{l-1,1} \Big].
%\end{align}
%
%We can similarly yield the relations for the perpendicular gradients:
%\begin{align}
%x \,\gradpYlm &= \almperp \gradpY^{m+1}_{l+1} + \blmperp \gradpY^{m+1}_{l-1} + \dlmperp \gradpY^{m-1}_{l+1} + \elmperp \gradpY^{m-1}_{l-1} \nonumber \\
%& \quad \quad \quad + \hlmperp \gradY^{m+1}_{l} + \jlmperp \gradY^{m-1}_{l}, \\
%y \,\gradpYlm &= i \, \Big[ -\almperp \gradpY^{m+1}_{l+1} - \blmperp \gradpY^{m+1}_{l-1} + \dlmperp \gradpY^{m-1}_{l+1} + \elmperp \gradpY^{m-1}_{l-1} \nonumber \\
%& \quad \quad \quad - \hlmperp \gradY^{m+1}_{l} + \jlmperp \gradY^{m-1}_{l}, \\
%z \,\gradpYlm &= \flmperp \gradpY^{m}_{l+1} + \glmperp \gradpY^{m}_{l-1} + \klmperp \gradY^{m}_{l},
%\end{align}
%where it can be shown that
%\begin{align}
%\almperp &= \alm^*, \quad \blmperp = \blm^*, \quad \dlmperp = \dlm^*, \quad \elmperp = \elm^*, \nonumber \\
%\flmperp = \flm^*,& \quad \glmperp = \glm^*, \quad \hlmperp = \hlm^*, \quad \jlmperp = \jlm^*, \quad \klmperp = \klm^*,
%\end{align}
%where $^*$ denotes the complex conjugate.


As for the scalar case, these recurrences above lead us to Jacobi matrices for the tangent space basis. Define $\VSHvecfull$ by
\bseqnnumber{
	\VSHvecfull = 
		\begin{pmatrix} 
			\VSHvecfull_0 \\ \VSHvecfull_1 \\ \vdots 
		\end{pmatrix}, \quad \text{where } \quad 
	\VSHvecfulll = 
		\begin{pmatrix} 
			(\gradY^{-l}_l)^\top \\ (\gradpY^{-l}_l)^\top \\ \vdots \\ (\gradY^{l}_l)^\top \\ (\gradpY^{l}_l)^\top
		\end{pmatrix} \in \C^{2(2l+1) \times 3} \quad \forall \: l \in \No. \label{eqn:VSHfulldef}
}

The Jacobi matrices are then defined according to the matrices $\tangentjacobi_x, \tangentjacobi_y, \tangentjacobi_z$ satisfying
\bseqnnumber{
	\tangentjacobi_x \VSHvecfull(x,y,z) &= x \VSHvecfull(x,y,z) \nonumber \\
	\tangentjacobi_y \VSHvecfull(x,y,z) &= y \VSHvecfull(x,y,z) \label{eqn:tangentjacobimatdef} \\ 
	\tangentjacobi_z \VSHvecfull(x,y,z) &= z \VSHvecfull(x,y,z) \nonumber
}
for each $(x,y,z) \in \Omega$. The tangent space Jacobi matrices are banded-block-banded due to the sparse relationships we obtain from \bsreflemma{lemma:VSHrecurrences}. Specifically, they each have block-bandwidths $(1,1)$:
\bseqn{
	\tangentjacobi_{x/y/z} &= 
		\begin{pmatrix}
			B_{x/y/z,0} & A_{x/y/z,0} & & & & \\
			C_{x/y/z,1} & B_{x/y/z,1} & A_{x/y/z,1} & & & \\
			& C_{x/y/z,2} & B_{x/y/z,2} & A_{x/y/z,2}  & & & \\
			& & C_{x/y/z,3} & \ddots & \ddots & \\
			& & & \ddots & \ddots & \ddots \\
		\end{pmatrix}.
}
Let $0_2 \in \R^{2\times2}$ be the 2x2 zero matrix. $\tangentjacobi_x$ has subblock-bandwidths $(4,4)$ since for $l \in \No$:
\bseqn{
	A_{x,l} &:= 
		\begin{pmatrix}
			\mathcal{A}_{l,-l,5} & 0_2 & \mathcal{A}_{l,-l,6} & & \\
			& \ddots & \ddots & \ddots & \\
			& & \mathcal{A}_{l,l,5} & 0_2 & \mathcal{A}_{l,l,6} \\
		\end{pmatrix} \in \R^{2(2l+1)\times2(2l+3)}, \\
	B_{x,l} &:= 
		\begin{pmatrix}
			0_2 & \mathcal{A}_{l,-l,4} & \\
			\mathcal{A}_{l,-l+1,3} & \ddots & \ddots \\
			& \ddots & \ddots & \mathcal{A}_{l,l-1,4} \\
			& & \mathcal{A}_{l,l,3} & 0_2
		\end{pmatrix}  \in \R^{2(2l+1)\times2(2l+1)}, \\
	C_{x,l} &:= 
		\begin{pmatrix}
			\mathcal{A}_{l,-l,2} & & & \\
			0_2 & \ddots & & \\
			\mathcal{A}_{l,-l+2,1} & \ddots & \ddots & \\
			& \ddots & \ddots & \mathcal{A}_{l,l-2,2} \\
			& & \ddots & 0_2 \\
			& & & \mathcal{A}_{l,l,1} \\
		\end{pmatrix} \in \R^{2(2l+1)\times2(2l-1)} \quad (l \ne 0),
}
where
\bseqn{
	\mathcal{A}_{l,m,j} := 
		\begin{pmatrix}
			A_{l,m,j} & 0 \\
			0 & A_{l,m,j}^*
		\end{pmatrix} \: \text{for } j = 1, 2, 5, 6, \quad
	\mathcal{A}_{l,m,j} := 
		\begin{pmatrix}
			0 & A_{l,m,j} \\
			A_{l,m,j}^* & 0
		\end{pmatrix} \: \text{for } j = 3,4.
}
Similarly, $\tangentjacobi_y$ also has subblock-bandwidths $(4,4)$ since for $l \in \No$:
\bseqn{
	A_{y,l} &:= 
		\begin{pmatrix}
			\mathcal{B}_{l,-l,5} & 0_2 & \mathcal{B}_{l,-l,6} & & \\
			& \ddots & \ddots & \ddots & \\
			& & \mathcal{B}_{l,l,5} & 0_2 & \mathcal{B}_{l,l,6} \\
		\end{pmatrix} \in \R^{2(2l+1)\times2(2l+3)}, \\
	B_{y,l} &:= 
		\begin{pmatrix}
			0_2 & \mathcal{B}_{l,-l,4} & \\
			\mathcal{B}_{l,-l+1,3} & \ddots & \ddots \\
			& \ddots & \ddots & \mathcal{B}_{l,l-1,4} \\
			& & \mathcal{B}_{l,l,3} & 0_2
		\end{pmatrix}  \in \R^{2(2l+1)\times2(2l+1)}, \\
	C_{y,l} &:= 
		\begin{pmatrix}
			\mathcal{B}_{l,-l,2} & & & \\
			0_2 & \ddots & & \\
			\mathcal{B}_{l,-l+2,1} & \ddots & \ddots & \\
			& \ddots & \ddots & \mathcal{B}_{l,l-2,2} \\
			& & \ddots & 0_2 \\
			& & & \mathcal{B}_{l,l,1} \\
		\end{pmatrix} \in \R^{2(2l+1)\times2(2l-1)} \quad (l \ne 0),
}
where
\bseqn{
	\mathcal{B}_{l,m,j} := 
		\begin{pmatrix}
			B_{l,m,j} & 0 \\
			0 & B_{l,m,j}^*
		\end{pmatrix} \: \text{for } j = 1, 2, 5, 6, \quad
	\mathcal{B}_{l,m,j} := 
		\begin{pmatrix}
			0 & B_{l,m,j} \\
			B_{l,m,j}^* & 0
		\end{pmatrix} \: \text{for } j = 3,4.
}
Finally, $\tangentjacobi_z$ has subblock-bandwidths $(2,2)$, as for $l \in \No$: 
\bseqn{
	A^z_l &:= 
		\begin{pmatrix}
			0 & 0 & \Gamma_{l,-l,3} \\
			& & & \Gamma_{l,-l,3}^* \\
			& & & & \ddots \\
			& & & & & \Gamma_{l,l,3} \\
			& & & & & & \Gamma_{l,l,3}^*& 0 & 0 \\
		\end{pmatrix} \in \R^{2(2l+1)\times2(2l+3)}, \\
	B^z_l &:= 
		\begin{pmatrix}
			0 & \Gamma_{l,-l,2} \\
			\Gamma_{l,-l,2}^* & 0 \\
			& & \ddots \\
			& & & 0 & \Gamma_{l,l,2} \\
			& & & \Gamma_{l,l,2}^* & 0 \\
		\end{pmatrix}  \in \R^{2(2l+1)\times2(2l+1)}, \\
	C^z_l &:= 
		\begin{pmatrix}
			0 \\
			0 \\
			\Gamma_{l,-l+1,1} \\
			& \Gamma_{l,-l+1,1}^* \\
			& & \ddots \\
			& & & \Gamma_{l,l-1,1} \\
			& & & & \Gamma_{l,l-1,1}^* \\
			& & & & 0 \\
			& & & & 0 \\
		\end{pmatrix} \in \R^{2(2l+1)\times2(2l-1)} \quad (l \ne 0).
}



\subsection{Three-term recurrence relation for $\VSHvecfull(x,y,z)$}

We can combine each system in \bsrefeqn{eqn:tangentjacobimatdef} into a block-tridiagonal system for any $(x,y,z) \in \Omega$:
\bseqn{
	\renewcommand\arraystretch{1.3}
	\begin{pmatrix}
		I_6 & & & \\
		B_1-G_1(x,y,z) & A_1 & & \\
		C_2 & B_2-G_2(x,y,z) & \quad A_3 \quad & \\
		& C_3 & B_3 - G_3(x,y,z)  & \ddots \\
		& & \ddots &\ddots
	\end{pmatrix}
	\VSHvecfull(x,y,z)
	=
	\begin{pmatrix}
		\VSHvecfull_1(x,y,z) \\ \vec{0} \\ \vec{0} \\ \vdots
	\end{pmatrix},
}
where we note that 
\bseqn{
	\VSHvecfull_{1}(x,y,z) := 
		\begin{pmatrix}
			\gradY_1^{-1}(x,y,z) \\ \gradpY_1^{-1}(x,y,z) \\ \gradY_1^{0}(x,y,z) \\ \gradpY_1^{0}(x,y,z) \\ \gradY_1^{1}(x,y,z) \\ \gradpY_1^{1}(x,y,z) \\
			\end{pmatrix}, 
}
can be calculated explicitly, and for each $l \in \N$,
\bseqnnumber{
	A_l &:= 
		\begin{pmatrix}
			A_{x,l} \\
			A_{y,l} \\
			A_{z,l}
		\end{pmatrix} \in \C^{6(2l+1)\times2(2l+3)}, \quad
	C_l := 
		\begin{pmatrix}
			C_{x,l} \\
			C_{y,l} \\
			C_{z,l}
		\end{pmatrix} \in \C^{6(2l+1)\times2(2l-1)} \quad (n \ne 0), \label{eqn:tangentclenshawmats1} \\
	B_l &:= 
		\begin{pmatrix}
			B_{x,l} \\
			B_{y,l} \\
			B_{z,l}
		\end{pmatrix} \in \C^{6(2l+1)\times2(2l+1)}, \quad
	G_n(x,y) := 
		\begin{pmatrix}
			x\idmat{2l+1} \\
			y\idmat{2l+1} \\
			z\idmat{2l+1}
		\end{pmatrix}  \in \C^{6(2l+1)\times2(2l+1)}. \label{eqn:tangentclenshawmats1}
}
For each $l \in \N$ let $\Dlt$ be any matrix that is a left inverse of $A_l$, i.e. such that $\Dlt A_l = \idmat{2(2l+3)}$. Multiplying our system by the preconditioner matrix that is given by the block diagonal matrix of the $\Dlt$'s, we obtain a lower triangular system \cite[p78]{dunkl2014orthogonal} which can be expanded to obtain the three-term recurrence:
\bseqn{
	\VSHvecfull_{l+1}(x,y,z) = -\Dlt [B_l-G_l(x,y,z)] \VSHvecfull_l(x,y,z) - \Dlt C_l  \, \VSHvecfull_{l-1}(x,y,z), \quad l \in \N
}
where of course we have that $\VSHvec(x,y,z) \equiv \vec{0}_{2\times3}$.

We note that we can choose the matrices $\Dlt$ in the following way. For $l \in \N$, we set
\begin{align}
\Dlt = \begin{pmatrix}
		\hat{A}^{x,y}_l & \zeromat{2(2l+3)\times2(2l+1)}
	  \end{pmatrix} \in \R^{2(2l+3)\times6(2l+1)}
\end{align}
where $\zeromat{2(2l+3)\times2(2l+1)}$ the zero matrix in $\R^{2(2l+3)\times2(2l+1)}$, and $\hat{A}^{x,y}_l \in \R^{2(2l+3)\times4(2l+1)}$ is the left inverse of the matrix $\begin{pmatrix} A^x_l \\ A^y_l \end{pmatrix}$, given by
\begin{align}
\hat{A}^{x,y}_l = \begin{pmatrix}
		\frac{1}{2d_{l,-l}} & 0 & \hdots & 0 & -\frac{i}{2d_{l,-l}} & 0 & \hdots &  \\
		0 & \frac{1}{2d^\perp_{l,-l}} & 0 & \hdots & 0 & -\frac{i}{2d^\perp_{l,-l}} & 0 & \hdots &  \\
		& & \ddots & & & & \ddots & & \\
		\vdots & & & \ddots & & & & \ddots & \\
		& & & & \frac{1}{2d_{l,l}} & 0 & \hdots & 0 & -\frac{i}{2d_{l,l}} & \\
		& & & & & \frac{1}{2d^\perp_{l,l}} & 0 & \hdots & 0 & -\frac{i}{2d^\perp_{l,l}} \\
		0 & \hdots & \frac{1}{2a_{l,l-1}} & 0 & \hdots & 0 & \frac{i}{2a_{l,l-1}} & 0 & 0 & 0 \\
		0 & \hdots & 0 & \frac{1}{2a^\perp_{l,l-1}} & 0 & \hdots & 0 & \frac{i}{2a^\perp_{l,l-1}} & 0 & 0\\
		0 & \hdots & \hdots & 0 & \frac{1}{2a_{l,l}} & 0 & \hdots & 0 & \frac{i}{2a_{l,l}} & 0 \\
		0 & \hdots & \hdots & & 0 & \frac{1}{2a^\perp_{l,l}} & 0 & \hdots & 0 & \frac{i}{2a^\perp_{l,l}} \\
	  \end{pmatrix}.
\end{align}
\bstodoinline{Derive Dlts again}



\subsection{Computational aspects}

Let $\uvec$ be a vector-valued function on $\Omega$ whose values are of the form
\bseqn{
	\uvec(x,y,z) = u_\varphi(x,y,z) \: \phivec + u_\theta(x,y,z) \: \thetavec, \quad (x,y,z) \in \Omega
}
for some scalar functions $u^\varphi, u^\theta$ where $\phivec, \thetavec$ are the standard non-radial unit basis vectors on the sphere defined by $\phivec := (\cos \theta \sin \varphi, \sin \theta \sin \varphi, \cos \varphi)^\top$, $\thetavec := (-\sin \theta, \cos \theta, 0)^\top$. Such a function $\uvec$ we refer to as a \textit{vector-valued function in the tangent space of $\Omega$}. We can then approximate this function by its expansion in the VSH basis, i.e. for some large enough $N \in \N$:
\bseqn{
	\uvec(x,y,z) \approx \VSHvecfull(x,y,z)^\top \uvec^c := \sum^N_{l=0} \sum^l_{m=-l} \big[u_{l,m} \, \gradYlm(x,y,z)  + u^\perp_{l,m} \, \gradpYlm(x,y,z) \big].
}

\subsubsection{Obtaining coefficients}
The development of vector spherical harmonic transforms is well established \cite{swarztrauber1993vector}, and continues today (see \cite{gia2019favest}). \bstodoinline{VSH Transform}

\subsubsection{Function evaluation}
The Clenshaw algorithm presented in \bsrefsection{subsubsection:clenshaw} can also be used to evaluate a vector-valued function in the tangent space for a point $(x,y,z) \in \Omega$:
\bseqn{
	\quad &\text{1) } \text{Set } \vec{\xi}_{N+2} = \bold{0}, \: \vec{\xi}_{N+2} = \bold{0}. \\
	\quad &\text{2) } \text{For } n = N:-1:1 \\
	\quad & \quad \quad \quad \text{set } \vec{\xi}_{n}^\top = (\mathbf{u}^c_n)^\top - \vec{\xi}_{n+1}^\top \Dnt (B_n - G_n) -  \vec{\xi}_{n+2}^\top D^\top_{n+1} C_{n+1} \\
	\quad &\text{3) } \text{Output: } \mathbf{u}(x,y,z) \approx \VSHvecfull_1(x,y,z)^\top \vec{\xi}_{1} \\
	&\quad \quad \quad \quad \quad \quad \quad \quad \quad = (\vec{\xi}_{1})_1 \gradY_1^{-1} + (\vec{\xi}_{1})_2 \gradpY_1^{-1} + (\vec{\xi}_{1})_3 \gradY_1^{0} \\
	&\quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad + (\vec{\xi}_{1})_4 \gradpY_1^{0} + (\vec{\xi}_{1})_5 \gradY_1^{1} + (\vec{\xi}_{1})_6 \gradpY_1^{1}.
}



\subsection{Sparse partial differential operators}

The framework we have outlined for the spherical harmonics and the vector spherical harmonics allows us to easily and explicitly derive sparse operator matrices for partial differential operators such as the spherical gradient, divergence and Laplacian, as well as other key operators useful in examples such as the linearised shallow water equations. These operators will take coefficients of a function's expansion in either the SSH or VSH basis, to coefficients in either basis. 

In order to ensure we fully capitalise on the natural sparsity of the relationships so that we yield banded-block-banded operators, we will \enquote{split} coefficient vectors of a vector-valued function on the tangent space of $\Omega$ into two. On that note, define $\VSHvec, \VSHvecperp$ by
\bseqnnumber{
	\VSHvec &:= 
		\begin{pmatrix} 
			\VSHvec_0 \\ \VSHvec_1 \\ \vdots 
		\end{pmatrix}, \quad \text{where } \quad 
	\VSHvecl := 
		\begin{pmatrix} 
			(\gradY^{-l}_l)^\top \\ \vdots \\ (\gradY^{l}_l)^\top
		\end{pmatrix} \in \C^{(2l+1) \times 3} \quad \forall \: l \in \No, \label{eqn:VSHdef} \\
	\VSHvecperp &:= 
		\begin{pmatrix} 
			\VSHvecperp_0 \\ \VSHvecperp_1 \\ \vdots 
		\end{pmatrix}, \quad \text{where } \quad 
	\VSHvecperpl := 
		\begin{pmatrix} 
			(\gradpY^{-l}_l)^\top \\ \vdots \\ (\gradpY^{l}_l)^\top
		\end{pmatrix} \in \C^{(2l+1) \times 3} \quad \forall \: l \in \No. \label{eqn:VSHperpdef}
}
Let $\uvec$ be a vector-valued function on the tangent space of $\Omega$ with coefficients vectors $\uvecc, \uveccperp$ for its expansion in the VSH basis up to order $N \in \N$, and let $f$ be a scalar function on $\Omega$ with coefficients vector $\fvecc$ for its expansion in the SSH basis also up to order $N$, i.e.
\bseqn{
	\uvec(x,y,z) &\approx \VSHvec(x,y,z)^\top \: \uvecc + \VSHvecperp(x,y,z)^\top \: \uveccperp \\
	&:=  \sum^N_{l=0} \sum^l_{m=-l} \big[u_{l,m} \, \gradYlm(x,y,z)  + u^\perp_{l,m} \, \gradpYlm(x,y,z) \big], \\
	f(x,y,z) &\approx \SHvec(x,y,z)^\top \: \fvecc :=  \sum^N_{l=0} \sum^l_{m=-l} f_{l,m} \, \Ylm(x,y,z)
}
We are now in a position to derive the sparse differential operators that can be applied to the functions $\uvec, f$.

\begin{definition}\label{def:SHoperators}
	We define the operator matrices $\cal{D}, \calG, \calL$ according to:
\bseqn{
	\divergence \uvec(x,y,z) &= \SHvec(x,y,z)^\top \: \calD \: \uvecc, \\
	\gradS f(x,y,z) &= \VSHvec(x,y,z)^\top \: \calG \: \fvecc, \\
	\DeltaS f(x,y,z) &= \SHvec(x,y,z)^\top \: \calL \: \fvecc.
}
\end{definition}

\begin{theorem}
	The operator matrices defined in \bsrefdef{def:SHoperators} are diagonal, and are given by:
\bseqn{
	\calG &= I_{(N+1)^2}, \quad
	\calD \equiv \calL := 
		\begin{pmatrix}
			\calL_0 & & \\
			& \ddots & \\
			& & \calL_N
		\end{pmatrix},
}
where
\bseqn{
	\calL_l &:= 
		\begin{pmatrix}
			-l(l+1) & & \\
			& \ddots & \\
			& & -l(l+1)
		\end{pmatrix} \in \R^{(2l+1) \times (2l+1)}.
}
\end{theorem}

\begin{proof}
	The argument for $\calG$ is trivial by definition. Now, the spherical harmonics, as the name eludes to, satisfy a harmonic relationship $\DeltaS \Ylm = \: l(l+1) \Ylm$ \bstodo{cite}. Thus, for the proof for $\calD$, consider
\bseqn{
	\divergence \uvec &= \divergence \Big( \sum_{l=0}^N \sum_{m=-l}^{l} [ u_{l,m} \gradYlm + u^{\perp}_{l,m} \gradpYlm ] \Big) \\
	&= \sum_{l=0}^N \sum_{m=-l}^{l} u_{l,m} \: \DeltaS \Ylm \\
	&= \sum_{l=0}^N \sum_{m=-l}^{l} - u_{l,m} \: l(l+1) \Ylm,
}
using the fact that $\divergence (\grad^\perp f )\equiv 0$ for any function $f$. We similarly have for $\calL$:
\bseqn{
	\DeltaS f &= \DeltaS \Big( \sum_{l=0}^N \sum_{m=-l}^{l} f_{l,m} \Ylm \Big) \\
	&= \sum_{l=0}^N \sum_{m=-l}^{l} f_{l,m} \: \DeltaS \Ylm \\
	&= \sum_{l=0}^N \sum_{m=-l}^{l} - f_{l,m} \: l(l+1) \Ylm.
}
\end{proof}


Now that we have our differential operators, let's apply them in an example. 


\section{Example: linear shallow water equations}

The linearised shallow water equations allow us to showcase the differential operators that we defined in \bsrefdef{def:SHoperators} (namely the divergence and gradient operators) and demonstrate how the natural sparsity that our framework brings to the problem leads to a simple sparse linear system to solve.

Let $\uvec(x,y,z)$ be the tangential velocity of a flow and $h(x,y,z)$ be the height deviation of the flow from some constant reference height $\calH$. Define $\rvec$ as the unit outward normal vector at the point on the sphere $(x,y,z)$, so that
\bseqn{
	\rvec = \begin{pmatrix} x \\ y \\ z \end{pmatrix}.
}
The linear SWEs are
\bseqn{
	\begin{cases}
		\pfpx{t}{\uvec} + f \rvec \times \uvec - \nabla h = \mathbf{0} \\
		\pfpx{t}{h} + \calH \nabla \cdot \uvec = 0
	\end{cases}
}
where $f = 2 \rotrate \cos(\varphi) =  2 \rotrate z$ is the Coriolis parameter, and $\rotrate = 7.2921  10^{-5}$ rad s$^{-1}$ is the rotation rate of the Earth (note that $\varphi = {\pi \over 2} - \text{latitude}$).

A keen eye may notice that we require one more operator not yet defined -- one for the Coriolis parameter cross product (i.e. $f \: \rvec \times \uvec$). 
\begin{definition}\label{def:coriolisoperator}
	Define the operator matrices $\calF, \calF^\perp$ according to:
\bseqn{
	f \: \rvec \times \uvec(x,y,z) &= \VSHvec(x,y,z)^\top \: \calF \: \uvec^{\perp c} + \Big(\VSHvecperp(x,y,z)\Big)^\top \: \calF^\perp \: \uvec^{c}
}
\end{definition}
\begin{lemma}
	The operators $\calF, \calF^\perp$ defined in \bsrefdef{def:coriolisoperator} are sparse with banded-block-banded structure. More specifically,
\begin{itemize}
	\item $\calF$ has block-bandwidths $(1,1)$, and sub-block-bandwidths $(1,1)$
	\item $\calF^\perp$ has block-bandwidths $(1,1)$, and sub-block-bandwidths $(1,1)$
\end{itemize}
\end{lemma}
\begin{proof}
	Using \bsreflemma{lemma:VSHrecurrences}, we have that:
\bseqn{
	f \: \rvec \times \bold{u} &= f \: \rvec \times \sum_{l=0}^{N} \sum_{m=-l}^{l} [ u_{l,m} \gradYlm + u^{\perp}_{l,m} \gradpYlm ] \\
	&= 2 \: \rotrate \: z \: \sum_{l=0}^{N} \sum_{m=-l}^{l} [ u_{l,m} \rvec \times \gradYlm + u^{\perp}_{l,m} \rvec \times ( \rvec \times \gradYlm ) ] \\
	&= 2 \: \rotrate \: \sum_{l=0}^{N} \sum_{m=-l}^{l} [ u_{l,m} z \: \gradpYlm - u^{\perp}_{l,m} z \: \gradYlm ) ] \\
	&= 2 \: \rotrate \: \sum_{l=0}^{N} \sum_{m=-l}^{l} \Big[ u_{l,m} \: \Big( \Gamma_{l,m,1}^* \gradpY^{m}_{l-1} + \Gamma_{l,m,3}^* \gradpY^{m}_{l+1} + \Gamma_{l,m,2} \gradY^{m}_{l} \Big) \\
	&\quad \quad \quad \quad \quad \quad \quad \quad - u^{\perp}_{l,m} \: \Big( \Gamma_{l,m,1} \gradY^{m}_{l-1} + \Gamma_{l,m,3} \gradY^{m}_{l+1} + \Gamma_{l,m,2}^* \gradpY^{m}_{l} \Big) \Big].
}
We can then write down the operators $\calF, \calF^\perp$ as follows:
\bseqn{
	\calF &= \bar{\calF^\perp} = 2 \: \rotrate \: 
		\begin{pmatrix}
			\calF_{0,2} & \calF_{1,1} & & & & \\
			\calF_{0,3} & \calF_{1,2} & \calF_{2,1} & & & \\
			& \calF_{1,3} & \calF_{2,2} & \calF_{3,1}  & & & \\
			& & \calF_{2,3} & \ddots & \ddots & \\
			& & & \ddots & \ddots & \ddots \\
		\end{pmatrix}
}
where $\bar{A}$ denotes the conjugate matrix of $A$ (i.e. where the entries of $\bar{A}$ are simply the complex conjugates of the entries of $A$) \cite[p.10]{courant1953methods}, and for $l = 0,\dots,N$
\bseqn{
	\calF_{l,1} &:= 
		\begin{pmatrix}
			0 & \Gamma_{l,-l+1,1} & & \\
			& & \ddots & & \\
			& & & \Gamma_{l,l-1,1} & 0 \\
		\end{pmatrix} \in \R^{(2l-1)\times(2l+1)}, \quad (l \ne 0), \\
	\calF_{l,2} &:= 
		\begin{pmatrix}
			\Gamma_{l,-l,2} & & \\
			& \ddots & \\
			& & \Gamma_{l,l,2} \\
		\end{pmatrix}  \in \R^{(2l+1)\times(2l+1)}, \\
	\calF_{l,3} &:= 
		\begin{pmatrix}
			0 \\
			\Gamma_{l,-l,3} \\
			& & \ddots \\
			& & & & \Gamma_{l,l,3} \\
			& & & & 0 \\
		\end{pmatrix} \in \R^{(2l+3)\times(2l+1)}.
}
\end{proof}

For simplicity, we implement a backward Euler timestepping method to solve the linear SWEs with timestep $\Delta t$:
\bseqn{
	\uvec_{n+1} &= \uvec_{n} + \Delta t \: (\nabla h_{n+1} - f \rvec \times \uvec_{n+1}) \\
	h_{n+1} &= h_n - \Delta t \: \calH \nabla \cdot \uvec_{n+1}
}
In coefficient space, this system becomes:
\bseqn{
	\uvec^c_{n+1} &= \uvec^c_{n} + \Delta t \: (\calG \vec{h}^c_{n+1} - \calF \uvec^{\perp c}_{n+1}) \\
	\uvec^{\perp c}_{n+1} &=  - \Delta t \: \calF^\perp \uvec^{c}_{n+1} \\
	\vec{h}^c_{n+1} &= \vec{h}^c_n - \Delta t \: \calH D \uvec^c_{n+1}
}
$\iff$
\bseqn{
	\uvec^c_{n+1} &= \uvec^c_{n} + \Delta t \: (\calG \vec{h}^c_n - \Delta t \: \calH \calG \calD \uvec^c_{n+1} + \Delta t \calF \calF^\perp \uvec^{c}_{n+1}) \\
	\uvec^{\perp c}_{n+1} &=  - \Delta t \: \calF^\perp \uvec^{c}_{n+1} \\
	\vec{h}^c_{n+1} &= \vec{h}^c_n - \Delta t \: \calH D \uvec^c_{n+1}
}
$\iff$
\bseqn{
	\uvec^c_{n+1} &= (I + \Delta t^2 \calH \calG \calD - \Delta t^2 \calF \calF^\perp)^{-1} \: (\uvec^c_{n} + \Delta t \: \calG \vec{h}^c_n) \\
	\uvec^{\perp c}_{n+1} &=  - \Delta t \: \calF^\perp \uvec^{c}_{n+1} \\
	\vec{h}^c_{n+1} &= \vec{h}^c_n - \Delta t \: \calH \calD \uvec^c_{n+1}.
}
Here, it is clear that the matrix $I + \Delta t^2 \calH \calG \calD - \Delta t^2 \calF \calF^\perp$ is sparse with banded-block-banded structure, and hence this system will be efficient to solve. Doing so at each iteration provides us with the coefficients vectors $\uvec^{c}_{n+1}, \uvec^{\perp c}_{n+1}, \vec{h}^{c}_{n+1}$ if we know $\uvec^{c}_{n}, \uvec^{\perp c}_{n}, \vec{h}^{c}_{n}$. 

\bstodo{Image}














  